{
    "version": "https://jsonfeed.org/version/1",
    "title": "逐梦 • All posts by \"cloudflare\" tag",
    "description": "Welcome to my blog",
    "home_page_url": "https://0xdadream.github.io",
    "items": [
        {
            "id": "https://0xdadream.github.io/2025/05/31/cloudflare-dai-li-pei-zhi-duan-kou/",
            "url": "https://0xdadream.github.io/2025/05/31/cloudflare-dai-li-pei-zhi-duan-kou/",
            "title": "Cloudflare代理配置端口",
            "date_published": "2025-05-31T08:25:00.000Z",
            "content_html": "<h1 id=\"Cloudflare代理配置端口\"><a href=\"#Cloudflare代理配置端口\" class=\"headerlink\" title=\"Cloudflare代理配置端口\"></a>Cloudflare代理配置端口</h1><h2 id=\"一、前提条件\"><a href=\"#一、前提条件\" class=\"headerlink\" title=\"一、前提条件\"></a>一、前提条件</h2><ul>\n<li>已有注册好的Cloudflare账号（免费即可）。</li>\n<li>已将你的域名成功接入Cloudflare（DNS已指向Cloudflare的Name Server）。</li>\n</ul>\n<hr>\n<h2 id=\"二、Cloudflare可用端口概述\"><a href=\"#二、Cloudflare可用端口概述\" class=\"headerlink\" title=\"二、Cloudflare可用端口概述\"></a>二、Cloudflare可用端口概述</h2><p>Cloudflare 仅能代理特定的HTTP和HTTPS端口。常用端口总结如下：</p>\n<table>\n<thead>\n<tr>\n<th>协议</th>\n<th>可用端口</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>HTTP</td>\n<td>80, 8080, 8880, 2052, 2082, 2086, 2095</td>\n</tr>\n<tr>\n<td>HTTPS</td>\n<td>443, 8443, 2053, 2083, 2087, 2096</td>\n</tr>\n</tbody></table>\n<p>如果你的应用需要使用其他端口（如SSH、FTP），则必须使用Cloudflare的Spectrum服务（通常为付费企业版服务）。</p>\n<hr>\n<h2 id=\"三、具体配置流程\"><a href=\"#三、具体配置流程\" class=\"headerlink\" title=\"三、具体配置流程\"></a>三、具体配置流程</h2><p>以将服务器的<code>8080</code>端口通过Cloudflare实现域名访问为例：</p>\n<h3 id=\"①-服务器端准备\"><a href=\"#①-服务器端准备\" class=\"headerlink\" title=\"① 服务器端准备\"></a>① 服务器端准备</h3><p>确保你的服务器端应用正常监听指定端口：</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># 例如：测试8080端口是否开启</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">netstat</span> <span class=\"token parameter variable\">-tunlp</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token number\">8080</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<h3 id=\"②-Cloudflare-DNS设置\"><a href=\"#②-Cloudflare-DNS设置\" class=\"headerlink\" title=\"② Cloudflare DNS设置\"></a>② Cloudflare DNS设置</h3><ul>\n<li>登录Cloudflare后台：<a href=\"https://dash.cloudflare.com/\">https://dash.cloudflare.com/</a></li>\n<li>选择已接入Cloudflare的域名。</li>\n<li>点击菜单栏中的<code>DNS</code>选项卡。</li>\n</ul>\n<h4 id=\"添加DNS记录：\"><a href=\"#添加DNS记录：\" class=\"headerlink\" title=\"添加DNS记录：\"></a>添加DNS记录：</h4><ul>\n<li>点击 <code>Add record</code>（添加记录）。</li>\n<li>类型选择 <code>A</code> 或 <code>CNAME</code>：<ul>\n<li>若为IP地址（例如服务器IP），选择<code>A</code>。</li>\n<li>若为其他域名，选择<code>CNAME</code>。</li>\n</ul>\n</li>\n</ul>\n<p>示例：</p>\n<table>\n<thead>\n<tr>\n<th>字段</th>\n<th>示例值</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Type</td>\n<td>A</td>\n</tr>\n<tr>\n<td>Name</td>\n<td><code>example</code> （即你希望访问的子域名）</td>\n</tr>\n<tr>\n<td>IPv4 address</td>\n<td><code>你的服务器IP</code></td>\n</tr>\n<tr>\n<td>Proxy status</td>\n<td>选择橙色云图标（✅代理）</td>\n</tr>\n</tbody></table>\n<ul>\n<li>最终访问域名形式如：<code>example.yourdomain.com</code></li>\n</ul>\n<h3 id=\"③-服务端口访问说明\"><a href=\"#③-服务端口访问说明\" class=\"headerlink\" title=\"③ 服务端口访问说明\"></a>③ 服务端口访问说明</h3><p>Cloudflare不会直接显示端口号在URL中。因此：</p>\n<ul>\n<li>如果你的服务器使用Cloudflare默认支持的端口（如8080），你在访问时<strong>不需要明确指定端口号</strong>。<ul>\n<li>实际请求如：<code>http://example.yourdomain.com</code></li>\n</ul>\n</li>\n<li>你的服务器上仍然监听的是8080端口，Cloudflare则自动将访问请求代理至此端口。</li>\n</ul>\n<p><strong>示例场景</strong>：</p>\n<table>\n<thead>\n<tr>\n<th>用户访问URL</th>\n<th>实际服务器监听端口</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>http://example.yourdomain.com</code></td>\n<td>8080</td>\n</tr>\n<tr>\n<td><code>https://example.yourdomain.com</code>（HTTPS）</td>\n<td>8443、443等（按需设置）</td>\n</tr>\n</tbody></table>\n<hr>\n<h2 id=\"四、HTTPS-配置\"><a href=\"#四、HTTPS-配置\" class=\"headerlink\" title=\"四、HTTPS 配置\"></a>四、HTTPS 配置</h2><p>若你希望使用HTTPS访问：</p>\n<ol>\n<li>到Cloudflare后台 → <code>SSL/TLS</code> 选项：<ul>\n<li>推荐设置为<code>Flexible</code>（最简单）或<code>Full</code>模式。</li>\n</ul>\n</li>\n<li>如果是<code>Full</code>模式（推荐）：<ul>\n<li>服务器上需要配置SSL证书（可以使用免费的证书如Let’s Encrypt）。</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"示例-Nginx-配置（Full-模式）：\"><a href=\"#示例-Nginx-配置（Full-模式）：\" class=\"headerlink\" title=\"示例 Nginx 配置（Full 模式）：\"></a>示例 Nginx 配置（Full 模式）：</h3><pre class=\"line-numbers language-nginx\" data-language=\"nginx\"><code class=\"language-nginx\"><span class=\"token directive\"><span class=\"token keyword\">server</span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token directive\"><span class=\"token keyword\">listen</span> <span class=\"token number\">8443</span> ssl</span><span class=\"token punctuation\">;</span> \n    <span class=\"token directive\"><span class=\"token keyword\">server_name</span> example.yourdomain.com</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token directive\"><span class=\"token keyword\">ssl_certificate</span>     /path/to/cert.pem</span><span class=\"token punctuation\">;</span>\n    <span class=\"token directive\"><span class=\"token keyword\">ssl_certificate_key</span> /path/to/key.pem</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token directive\"><span class=\"token keyword\">location</span> /</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token directive\"><span class=\"token keyword\">proxy_pass</span> http://localhost:8080</span><span class=\"token punctuation\">;</span>\n        <span class=\"token directive\"><span class=\"token keyword\">proxy_set_header</span> Host <span class=\"token variable\">$host</span></span><span class=\"token punctuation\">;</span>\n        <span class=\"token directive\"><span class=\"token keyword\">proxy_set_header</span> X-Forwarded-For <span class=\"token variable\">$proxy_add_x_forwarded_for</span></span><span class=\"token punctuation\">;</span>\n        <span class=\"token directive\"><span class=\"token keyword\">proxy_set_header</span> X-Real-IP <span class=\"token variable\">$remote_addr</span></span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<ul>\n<li>Cloudflare → 8443（HTTPS）→ Nginx → 8080（HTTP内网服务）</li>\n</ul>\n<hr>\n<h2 id=\"五、其他非标准端口（如SSH、FTP）支持方法\"><a href=\"#五、其他非标准端口（如SSH、FTP）支持方法\" class=\"headerlink\" title=\"五、其他非标准端口（如SSH、FTP）支持方法\"></a>五、其他非标准端口（如SSH、FTP）支持方法</h2><ul>\n<li>默认Cloudflare免费版不支持SSH、FTP等非HTTP端口代理。</li>\n<li>若有这类需求，可以购买Cloudflare Spectrum服务：<ul>\n<li>在Cloudflare后台，进入Spectrum（频谱）服务，选择协议和端口映射到你的服务器IP地址即可。</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h2 id=\"六、常见问题与解决办法\"><a href=\"#六、常见问题与解决办法\" class=\"headerlink\" title=\"六、常见问题与解决办法\"></a>六、常见问题与解决办法</h2><ul>\n<li><strong>访问失败或返回522错误</strong>：<ul>\n<li>检查服务器端防火墙是否允许Cloudflare IP段访问服务器端口。</li>\n<li>检查服务器程序是否正常运行，端口是否已开启。</li>\n</ul>\n</li>\n<li><strong>SSL问题</strong>：<ul>\n<li>Flexible模式下，无需服务器端SSL证书（Cloudflare自动处理）。</li>\n<li>Full模式必须安装SSL证书。</li>\n</ul>\n</li>\n</ul>\n",
            "tags": [
                "cloudflare"
            ]
        }
    ]
}